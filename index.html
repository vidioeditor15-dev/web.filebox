<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PinGallery - Platform Berbagi Gambar</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --primary-color: #e60023;
        --secondary-color: #111;
        --background: #ffffff;
        --surface: #efefef;
        --text-primary: #111;
        --text-secondary: #767676;
        --border-radius: 8px;
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, sans-serif;
        background: var(--background);
        color: var(--text-primary);
        line-height: 1.6;
        overflow-x: hidden;
      }

      /* Header */
      header {
        position: sticky;
        top: 0;
        background: var(--background);
        border-bottom: 1px solid var(--surface);
        z-index: 100;
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.95);
      }

      nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.75rem 2rem;
        max-width: 1400px;
        margin: 0 auto;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--primary-color);
        cursor: pointer;
        transition: var(--transition);
      }

      .logo:hover {
        transform: scale(1.05);
      }

      .nav-actions {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .btn {
        padding: 0.75rem 1.5rem;
        border-radius: 24px;
        border: none;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
      }

      .btn-primary {
        background: var(--primary-color);
        color: white;
      }

      .btn-primary:hover {
        background: #cc001f;
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }

      .btn-secondary {
        background: var(--surface);
        color: var(--text-primary);
      }

      .btn-secondary:hover {
        background: #ddd;
      }

      /* Tombol Kembali di Header */
      .btn-back {
        background: transparent;
        color: var(--text-primary);
        border: 1px solid var(--surface);
      }

      .btn-back:hover {
        background: var(--surface);
        transform: translateX(-2px);
      }

      /* User Menu */
      .user-menu {
        position: relative;
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        transition: var(--transition);
        border: 2px solid transparent;
      }

      .user-avatar:hover {
        border-color: var(--primary-color);
        transform: scale(1.05);
      }

      .user-dropdown {
        position: absolute;
        top: 100%;
        right: 0;
        margin-top: 0.5rem;
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-lg);
        min-width: 200px;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: var(--transition);
      }

      .user-dropdown.active {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      .dropdown-item {
        padding: 0.75rem 1rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        cursor: pointer;
        transition: var(--transition);
        border-bottom: 1px solid var(--surface);
      }

      .dropdown-item:last-child {
        border-bottom: none;
      }

      .dropdown-item:hover {
        background: var(--surface);
      }

      .dropdown-item i {
        width: 20px;
        color: var(--text-secondary);
      }

      .dropdown-divider {
        height: 1px;
        background: var(--surface);
        margin: 0.5rem 0;
      }

      /* Page Header untuk halaman khusus */
      .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding: 0 2rem;
        max-width: 1400px;
        margin: 2rem auto;
      }

      .page-title {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .page-title h2 {
        font-size: 1.75rem;
        color: var(--text-primary);
      }

      .page-actions {
        display: flex;
        gap: 1rem;
      }

      /* Floating Back Button */
      .floating-back-btn {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        background: var(--primary-color);
        color: white;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        border: none;
        box-shadow: var(--shadow-lg);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        z-index: 1000;
        transition: var(--transition);
      }

      .floating-back-btn:hover {
        background: #cc001f;
        transform: scale(1.1);
      }

      .floating-back-btn i {
        font-size: 1.5rem;
      }

      /* Hero Section dengan Search Bar */
      .hero {
        padding: 3rem 2rem;
        text-align: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        position: relative;
        overflow: hidden;
      }

      .hero::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.1" d="M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,122.7C672,117,768,139,864,154.7C960,171,1056,181,1152,165.3C1248,149,1344,107,1392,85.3L1440,64L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>')
          no-repeat bottom;
        background-size: cover;
      }

      .hero-content {
        position: relative;
        max-width: 800px;
        margin: 0 auto;
      }

      .hero h1 {
        font-size: 3rem;
        margin-bottom: 1rem;
        animation: fadeInUp 0.8s ease;
      }

      .hero p {
        font-size: 1.25rem;
        margin-bottom: 2rem;
        opacity: 0.95;
        animation: fadeInUp 0.8s ease 0.2s both;
      }

      /* Search Bar di Hero */
      .hero-search-container {
        margin: 2rem auto 1rem;
        max-width: 600px;
        position: relative;
        animation: fadeInUp 0.8s ease 0.4s both;
      }

      .hero-search-bar {
        width: 100%;
        padding: 1rem 3rem 1rem 1.5rem;
        border-radius: 30px;
        border: none;
        background: rgba(255, 255, 255, 0.95);
        font-size: 1.1rem;
        transition: var(--transition);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      }

      .hero-search-bar:focus {
        outline: none;
        background: white;
        box-shadow: 0 6px 25px rgba(0, 0, 0, 0.3);
        transform: translateY(-2px);
      }

      .hero-search-btn {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .hero-search-btn:hover {
        background: #cc001f;
        transform: translateY(-50%) scale(1.1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }

      /* Auth Modals - DIPERBAIKI untuk scroll */
      .auth-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        z-index: 2000;
        animation: fadeIn 0.3s ease;
        overflow-y: auto;
      }

      .auth-modal.active {
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding: 2rem 0;
      }

      .auth-container {
        background: white;
        border-radius: 16px;
        width: 90%;
        max-width: 450px;
        max-height: 85vh;
        overflow-y: auto;
        padding: 2rem;
        position: relative;
        animation: slideUp 0.3s ease;
        margin: auto 0;
      }

      .auth-header {
        text-align: center;
        margin-bottom: 2rem;
        position: sticky;
        top: 0;
        background: white;
        z-index: 1;
        padding-bottom: 1rem;
      }

      .auth-header h2 {
        color: var(--text-primary);
        margin-bottom: 0.5rem;
      }

      .auth-header p {
        color: var(--text-secondary);
        font-size: 0.9rem;
      }

      .auth-tabs {
        display: flex;
        margin-bottom: 2rem;
        background: var(--surface);
        border-radius: 8px;
        padding: 0.25rem;
      }

      .auth-tab {
        flex: 1;
        padding: 0.75rem;
        background: transparent;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: var(--transition);
        color: var(--text-secondary);
      }

      .auth-tab.active {
        background: white;
        color: var(--primary-color);
        box-shadow: var(--shadow-sm);
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      .form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: var(--text-primary);
      }

      .form-input {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 2px solid var(--surface);
        border-radius: 8px;
        font-size: 1rem;
        transition: var(--transition);
      }

      .form-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(230, 0, 35, 0.1);
      }

      .form-input.error {
        border-color: #ef4444;
      }

      .form-textarea {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 2px solid var(--surface);
        border-radius: 8px;
        font-size: 1rem;
        transition: var(--transition);
        resize: vertical;
        min-height: 100px;
        font-family: inherit;
      }

      .form-textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(230, 0, 35, 0.1);
      }

      .error-message {
        color: #ef4444;
        font-size: 0.875rem;
        margin-top: 0.25rem;
        display: none;
      }

      .error-message.show {
        display: block;
      }

      .password-wrapper {
        position: relative;
      }

      .password-toggle {
        position: absolute;
        right: 1rem;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: var(--text-secondary);
        cursor: pointer;
        transition: var(--transition);
      }

      .password-toggle:hover {
        color: var(--primary-color);
      }

      .auth-submit {
        width: 100%;
        padding: 0.875rem;
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
      }

      .auth-submit:hover {
        background: #cc001f;
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      .auth-submit:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .auth-divider {
        text-align: center;
        margin: 1.5rem 0;
        position: relative;
      }

      .auth-divider::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        height: 1px;
        background: var(--surface);
      }

      .auth-divider span {
        background: white;
        padding: 0 1rem;
        position: relative;
        color: var(--text-secondary);
        font-size: 0.875rem;
      }

      .social-login {
        display: flex;
        gap: 1rem;
        margin-bottom: 1.5rem;
      }

      .social-btn {
        flex: 1;
        padding: 0.75rem;
        border: 2px solid var(--surface);
        background: white;
        border-radius: 8px;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        font-weight: 500;
      }

      .social-btn:hover {
        border-color: var(--primary-color);
        transform: translateY(-2px);
        box-shadow: var(--shadow-sm);
      }

      .auth-close {
        position: sticky;
        top: 0;
        right: 0;
        background: none;
        border: none;
        font-size: 1.5rem;
        color: var(--text-secondary);
        cursor: pointer;
        transition: var(--transition);
        z-index: 2;
        float: right;
        margin-bottom: 1rem;
      }

      .auth-close:hover {
        color: var(--text-primary);
        transform: scale(1.1);
      }

      /* Custom Scrollbar untuk semua modal */
      .auth-container::-webkit-scrollbar,
      .upload-container::-webkit-scrollbar,
      .settings-container::-webkit-scrollbar,
      .board-detail-container::-webkit-scrollbar,
      .board-container::-webkit-scrollbar,
      .share-container::-webkit-scrollbar,
      .create-board-container::-webkit-scrollbar,
      .asset-detail-container::-webkit-scrollbar {
        width: 8px;
      }

      .auth-container::-webkit-scrollbar-track,
      .upload-container::-webkit-scrollbar-track,
      .settings-container::-webkit-scrollbar-track,
      .board-detail-container::-webkit-scrollbar-track,
      .board-container::-webkit-scrollbar-track,
      .share-container::-webkit-scrollbar-track,
      .create-board-container::-webkit-scrollbar-track,
      .asset-detail-container::-webkit-scrollbar-track {
        background: var(--surface);
        border-radius: 4px;
      }

      .auth-container::-webkit-scrollbar-thumb,
      .upload-container::-webkit-scrollbar-thumb,
      .settings-container::-webkit-scrollbar-thumb,
      .board-detail-container::-webkit-scrollbar-thumb,
      .board-container::-webkit-scrollbar-thumb,
      .share-container::-webkit-scrollbar-thumb,
      .create-board-container::-webkit-scrollbar-thumb,
      .asset-detail-container::-webkit-scrollbar-thumb {
        background: var(--primary-color);
        border-radius: 4px;
      }

      .auth-container::-webkit-scrollbar-thumb:hover,
      .upload-container::-webkit-scrollbar-thumb:hover,
      .settings-container::-webkit-scrollbar-thumb:hover,
      .board-detail-container::-webkit-scrollbar-thumb:hover,
      .board-container::-webkit-scrollbar-thumb:hover,
      .share-container::-webkit-scrollbar-thumb:hover,
      .create-board-container::-webkit-scrollbar-thumb:hover,
      .asset-detail-container::-webkit-scrollbar-thumb:hover {
        background: #cc001f;
      }

      /* Profile Section */
      .profile-section {
        padding: 2rem;
        max-width: 1200px;
        margin: 0 auto;
        display: none;
      }

      .profile-section.active {
        display: block;
      }

      .profile-header {
        display: flex;
        align-items: center;
        gap: 2rem;
        margin-bottom: 1.5rem;
        padding: 2rem;
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-sm);
      }

      .profile-avatar {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        object-fit: cover;
        border: 4px solid var(--primary-color);
      }

      .profile-info h2 {
        margin-bottom: 0.5rem;
        color: var(--text-primary);
      }

      .profile-stats {
        display: flex;
        gap: 2rem;
        margin-top: 1rem;
      }

      .profile-stat {
        text-align: center;
      }

      .profile-stat-value {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--primary-color);
      }

      .profile-stat-label {
        font-size: 0.875rem;
        color: var(--text-secondary);
      }

      /* Profile Details Section - BARU */
      .profile-details-section {
        margin-bottom: 2rem;
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-sm);
        padding: 2rem;
        display: none;
      }

      .profile-details-section.active {
        display: block;
        animation: fadeIn 0.5s ease;
      }

      .profile-details-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--surface);
      }

      .profile-details-header h3 {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--text-primary);
      }

      .profile-info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
      }

      .info-item {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .info-label {
        font-size: 0.875rem;
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .info-value {
        font-size: 1rem;
        color: var(--text-primary);
        font-weight: 500;
        padding: 0.5rem 0;
        min-height: 40px;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .info-value.empty {
        color: var(--text-secondary);
        font-style: italic;
      }

      .edit-details-btn {
        background: var(--surface);
        color: var(--text-primary);
        border: none;
        border-radius: var(--border-radius);
        padding: 0.5rem 1rem;
        cursor: pointer;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
      }

      .edit-details-btn:hover {
        background: #ddd;
        transform: translateY(-2px);
      }

      .profile-bio {
        grid-column: 1 / -1;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid var(--surface);
      }

      .bio-content {
        line-height: 1.6;
        white-space: pre-line;
      }

      /* Toggle switch untuk menampilkan/sembunyikan info profil */
      .profile-info-toggle {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1.5rem;
        padding: 1rem;
        background: var(--surface);
        border-radius: var(--border-radius);
        cursor: pointer;
        transition: var(--transition);
      }

      .profile-info-toggle:hover {
        background: #e9e9e9;
      }

      .toggle-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .toggle-header h4 {
        color: var(--text-primary);
        margin: 0;
      }

      .toggle-arrow {
        transition: var(--transition);
      }

      .toggle-arrow.active {
        transform: rotate(180deg);
      }

      /* Upload Section in Profile */
      .profile-upload-section {
        margin-bottom: 2rem;
      }

      .section-title {
        font-size: 1.5rem;
        margin-bottom: 1rem;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .upload-area {
        border: 3px dashed var(--primary-color);
        border-radius: var(--border-radius);
        padding: 3rem;
        text-align: center;
        background: linear-gradient(135deg, #ff6b6b10 0%, #e6002310 100%);
        cursor: pointer;
        transition: var(--transition);
        position: relative;
        overflow: hidden;
      }

      .upload-area:hover {
        border-color: #cc001f;
        background: linear-gradient(135deg, #ff6b6b20 0%, #e6002320 100%);
        transform: translateY(-2px);
      }

      .upload-area.dragover {
        background: linear-gradient(135deg, #ff6b6b30 0%, #e6002330 100%);
        border-color: #cc001f;
      }

      .upload-icon {
        font-size: 4rem;
        color: var(--primary-color);
        margin-bottom: 1rem;
        animation: pulse 2s infinite;
      }

      #fileInput {
        display: none;
      }

      /* Upload Modal - DIPERBAIKI */
      .upload-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        z-index: 2000;
        animation: fadeIn 0.3s ease;
        overflow-y: auto;
      }

      .upload-modal.active {
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding: 2rem 0;
      }

      .upload-container {
        background: white;
        border-radius: 16px;
        width: 90%;
        max-width: 600px;
        max-height: 85vh;
        overflow-y: auto;
        padding: 2rem;
        position: relative;
        animation: slideUp 0.3s ease;
        margin: auto 0;
      }

      .upload-header {
        text-align: center;
        margin-bottom: 2rem;
        position: sticky;
        top: 0;
        background: white;
        z-index: 1;
        padding-bottom: 1rem;
      }

      .upload-header h2 {
        color: var(--text-primary);
        margin-bottom: 0.5rem;
      }

      .upload-preview {
        margin-bottom: 2rem;
        text-align: center;
      }

      .upload-preview img {
        max-width: 100%;
        max-height: 300px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-md);
      }

      .form-select {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 2px solid var(--surface);
        border-radius: 8px;
        font-size: 1rem;
        transition: var(--transition);
        background: white;
        cursor: pointer;
      }

      .form-select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(230, 0, 35, 0.1);
      }

      .tags-input-container {
        position: relative;
      }

      .tags-display {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.5rem;
      }

      .tag {
        background: var(--primary-color);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 16px;
        font-size: 0.875rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        animation: fadeIn 0.3s ease;
      }

      .tag-remove {
        cursor: pointer;
        font-size: 1rem;
        transition: var(--transition);
      }

      .tag-remove:hover {
        transform: scale(1.2);
      }

      .upload-actions {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
        position: sticky;
        bottom: 0;
        background: white;
        padding-top: 1rem;
        padding-bottom: 1rem;
      }

      .upload-actions .btn {
        flex: 1;
        justify-content: center;
      }

      /* Categories */
      .categories {
        padding: 2rem;
        max-width: 1200px;
        margin: 0 auto;
      }

      .category-pills {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        justify-content: center;
      }

      .category-pill {
        padding: 0.5rem 1.5rem;
        border-radius: 20px;
        background: var(--surface);
        color: var(--text-primary);
        cursor: pointer;
        transition: var(--transition);
        border: 2px solid transparent;
        font-weight: 500;
      }

      .category-pill:hover {
        background: var(--primary-color);
        color: white;
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      .category-pill.active {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
      }

      /* Gallery Grid */
      .gallery-section {
        padding: 2rem;
        max-width: 1400px;
        margin: 0 auto;
      }

      .gallery-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
      }

      .view-options {
        display: flex;
        gap: 0.5rem;
      }

      .view-btn {
        padding: 0.5rem;
        background: var(--surface);
        border: none;
        border-radius: var(--border-radius);
        cursor: pointer;
        transition: var(--transition);
      }

      .view-btn:hover {
        background: var(--primary-color);
        color: white;
      }

      .view-btn.active {
        background: var(--primary-color);
        color: white;
      }

      .gallery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1.5rem;
        animation: fadeIn 0.5s ease;
      }

      .gallery-grid.masonry {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        grid-auto-rows: 10px;
      }

      .image-card {
        background: white;
        border-radius: var(--border-radius);
        overflow: hidden;
        box-shadow: var(--shadow-sm);
        transition: var(--transition);
        cursor: pointer;
        position: relative;
        animation: fadeInUp 0.5s ease;
      }

      .gallery-grid.masonry .image-card {
        margin-bottom: 1rem;
      }

      .image-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-lg);
      }

      .image-wrapper {
        position: relative;
        overflow: hidden;
        background: var(--surface);
      }

      .gallery-grid .image-wrapper {
        padding-bottom: 125%;
      }

      .gallery-grid.masonry .image-wrapper {
        padding-bottom: var(--image-height);
      }

      .image-card img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: var(--transition);
      }

      .image-card:hover img {
        transform: scale(1.05);
      }

      .image-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          to bottom,
          transparent 0%,
          rgba(0, 0, 0, 0.7) 100%
        );
        opacity: 0;
        transition: var(--transition);
        display: flex;
        align-items: flex-end;
        padding: 1rem;
      }

      .image-card:hover .image-overlay {
        opacity: 1;
      }

      .overlay-actions {
        display: flex;
        gap: 0.5rem;
        width: 100%;
      }

      .overlay-btn {
        flex: 1;
        padding: 0.5rem;
        background: rgba(255, 255, 255, 0.9);
        border: none;
        border-radius: var(--border-radius);
        cursor: pointer;
        transition: var(--transition);
        font-weight: 600;
      }

      .overlay-btn:hover {
        background: white;
        transform: scale(1.05);
      }

      .overlay-btn.liked {
        background: var(--primary-color);
        color: white;
      }

      .overlay-btn.saved {
        background: #111;
        color: white;
      }

      .image-info {
        padding: 1rem;
      }

      .image-title {
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--text-primary);
      }

      .image-description {
        font-size: 0.875rem;
        color: var(--text-secondary);
        margin-bottom: 0.5rem;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .image-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.25rem;
        margin-bottom: 0.5rem;
      }

      .image-tag {
        background: var(--surface);
        color: var(--text-secondary);
        padding: 0.125rem 0.5rem;
        border-radius: 12px;
        font-size: 0.75rem;
      }

      .image-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: var(--text-secondary);
        font-size: 0.875rem;
      }

      .image-stats {
        display: flex;
        gap: 1rem;
      }

      .stat {
        display: flex;
        align-items: center;
        gap: 0.25rem;
      }

      /* Enhanced Image Detail Modal - DIPERBAIKI */
      .image-detail-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.95);
        z-index: 3000;
        animation: fadeIn 0.3s ease;
        overflow-y: auto;
      }

      .image-detail-modal.active {
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding: 2rem 0;
      }

      .image-detail-container {
        width: 95%;
        max-width: 1400px;
        max-height: 90vh;
        background: white;
        border-radius: 16px;
        overflow: hidden;
        display: flex;
        animation: slideUp 0.3s ease;
        margin: auto 0;
      }

      .image-detail-left {
        flex: 1.5;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f8f8f8;
        position: relative;
        overflow: hidden;
        max-height: 90vh;
      }

      .image-detail-right {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
        max-height: 90vh;
      }

      .image-detail-close {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        cursor: pointer;
        transition: var(--transition);
        z-index: 10;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .image-detail-close:hover {
        background: rgba(0, 0, 0, 0.9);
        transform: scale(1.1);
      }

      .image-detail-img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        cursor: zoom-in;
        transition: var(--transition);
      }

      .image-detail-img.zoomed {
        cursor: zoom-out;
        transform: scale(1.5);
      }

      /* Tombol Download di Gambar Detail */
      .image-download-btn {
        position: absolute;
        bottom: 20px;
        right: 20px;
        background: var(--primary-color);
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 24px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        font-size: 0.9rem;
        z-index: 10;
        transition: var(--transition);
        box-shadow: var(--shadow-md);
      }

      .image-download-btn:hover {
        background: #cc001f;
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }

      .image-detail-header {
        padding: 2rem 2rem 1rem;
        border-bottom: 1px solid var(--surface);
        position: sticky;
        top: 0;
        background: white;
        z-index: 1;
      }

      .image-detail-title {
        font-size: 1.75rem;
        font-weight: bold;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
      }

      .image-detail-meta {
        display: flex;
        align-items: center;
        gap: 1rem;
        color: var(--text-secondary);
        font-size: 0.875rem;
      }

      .image-detail-author {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .author-avatar {
        width: 24px;
        height: 24px;
        border-radius: 50%;
      }

      .image-detail-actions {
        padding: 1.5rem 2rem;
        display: flex;
        gap: 1rem;
        border-bottom: 1px solid var(--surface);
      }

      .detail-action-btn {
        flex: 1;
        padding: 0.875rem;
        border: 2px solid var(--surface);
        background: white;
        border-radius: 8px;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        font-weight: 600;
        color: var(--text-primary);
      }

      .detail-action-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      .detail-action-btn.primary {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
      }

      .detail-action-btn.primary:hover {
        background: #cc001f;
        border-color: #cc001f;
      }

      .detail-action-btn.liked {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
      }

      .detail-action-btn.saved {
        background: var(--secondary-color);
        color: white;
        border-color: var(--secondary-color);
      }

      .image-detail-info {
        padding: 1.5rem 2rem;
        padding-bottom: 3rem;
      }

      .info-section {
        margin-bottom: 1.5rem;
      }

      .info-section:last-child {
        margin-bottom: 0;
      }

      .info-label {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .info-content {
        color: var(--text-secondary);
        line-height: 1.6;
      }

      .image-detail-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.5rem;
      }

      .detail-tag {
        background: var(--surface);
        color: var(--text-primary);
        padding: 0.375rem 0.75rem;
        border-radius: 16px;
        font-size: 0.875rem;
        cursor: pointer;
        transition: var(--transition);
      }

      .detail-tag:hover {
        background: var(--primary-color);
        color: white;
        transform: translateY(-2px);
      }

      .file-info {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin-top: 0.5rem;
      }

      .file-info-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--text-secondary);
        font-size: 0.875rem;
      }

      /* Floating download button */
      .floating-download-btn {
        position: fixed;
        bottom: 80px;
        right: 20px;
        background: var(--primary-color);
        color: white;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        border: none;
        box-shadow: var(--shadow-lg);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        z-index: 1000;
        transition: var(--transition);
      }

      .floating-download-btn:hover {
        background: #cc001f;
        transform: scale(1.1);
      }

      /* Download Options Modal */
      .download-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        z-index: 4000;
        animation: fadeIn 0.3s ease;
        overflow-y: auto;
      }

      .download-modal.active {
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding: 2rem 0;
      }

      .download-container {
        background: white;
        border-radius: 16px;
        width: 90%;
        max-width: 500px;
        max-height: 85vh;
        overflow-y: auto;
        padding: 2rem;
        position: relative;
        animation: slideUp 0.3s ease;
        margin: auto 0;
      }

      .download-header {
        text-align: center;
        margin-bottom: 2rem;
        position: sticky;
        top: 0;
        background: white;
        z-index: 1;
        padding-bottom: 1rem;
      }

      .download-header h3 {
        color: var(--text-primary);
        margin-bottom: 0.5rem;
      }

      .download-options {
        margin-bottom: 1.5rem;
      }

      .download-option {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        border: 2px solid var(--surface);
        border-radius: 8px;
        margin-bottom: 1rem;
        cursor: pointer;
        transition: var(--transition);
      }

      .download-option:hover {
        border-color: var(--primary-color);
        background: rgba(230, 0, 35, 0.05);
      }

      .option-info h4 {
        margin: 0 0 0.25rem 0;
        color: var(--text-primary);
      }

      .option-info p {
        margin: 0;
        font-size: 0.875rem;
        color: var(--text-secondary);
      }

      .download-option i {
        color: var(--primary-color);
        font-size: 1.25rem;
      }

      /* Board Modal - DIPERBAIKI */
      .board-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        z-index: 4000;
        animation: fadeIn 0.3s ease;
        overflow-y: auto;
      }

      .board-modal.active {
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding: 2rem 0;
      }

      .board-container {
        background: white;
        border-radius: 16px;
        width: 90%;
        max-width: 500px;
        max-height: 85vh;
        overflow-y: auto;
        padding: 2rem;
        position: relative;
        animation: slideUp 0.3s ease;
        margin: auto 0;
      }

      .board-header {
        text-align: center;
        margin-bottom: 2rem;
        position: sticky;
        top: 0;
        background: white;
        z-index: 1;
        padding-bottom: 1rem;
      }

      .board-header h3 {
        color: var(--text-primary);
        margin-bottom: 0.5rem;
      }

      .boards-list {
        margin-bottom: 1.5rem;
      }

      .board-item {
        display: flex;
        align-items: center;
        padding: 1rem;
        border: 2px solid var(--surface);
        border-radius: 8px;
        margin-bottom: 0.75rem;
        cursor: pointer;
        transition: var(--transition);
      }

      .board-item:hover {
        border-color: var(--primary-color);
        background: rgba(230, 0, 35, 0.05);
      }

      .board-item.selected {
        border-color: var(--primary-color);
        background: rgba(230, 0, 35, 0.1);
      }

      .board-cover {
        width: 50px;
        height: 50px;
        border-radius: 8px;
        object-fit: cover;
        margin-right: 1rem;
      }

      .board-info h4 {
        color: var(--text-primary);
        margin-bottom: 0.25rem;
      }

      .board-info p {
        color: var(--text-secondary);
        font-size: 0.875rem;
      }

      .create-board {
        width: 100%;
        padding: 0.875rem;
        background: var(--surface);
        border: 2px dashed var(--text-secondary);
        border-radius: 8px;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        color: var(--text-secondary);
        font-weight: 600;
      }

      .create-board:hover {
        border-color: var(--primary-color);
        color: var(--primary-color);
        background: rgba(230, 0, 35, 0.05);
      }

      .board-actions {
        display: flex;
        gap: 1rem;
        margin-top: 1.5rem;
        position: sticky;
        bottom: 0;
        background: white;
        padding-top: 1rem;
      }

      .board-actions .btn {
        flex: 1;
        justify-content: center;
      }

      /* Share Modal - DIPERBAIKI */
      .share-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        z-index: 4000;
        animation: fadeIn 0.3s ease;
        overflow-y: auto;
      }

      .share-modal.active {
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding: 2rem 0;
      }

      .share-container {
        background: white;
        border-radius: 16px;
        width: 90%;
        max-width: 450px;
        max-height: 85vh;
        overflow-y: auto;
        padding: 2rem;
        position: relative;
        animation: slideUp 0.3s ease;
        margin: auto 0;
      }

      .share-header {
        text-align: center;
        margin-bottom: 2rem;
        position: sticky;
        top: 0;
        background: white;
        z-index: 1;
        padding-bottom: 1rem;
      }

      .share-header h3 {
        color: var(--text-primary);
        margin-bottom: 0.5rem;
      }

      .share-options {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
        margin-bottom: 2rem;
      }

      .share-option {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 1rem;
        border: 2px solid var(--surface);
        border-radius: 8px;
        cursor: pointer;
        transition: var(--transition);
      }

      .share-option:hover {
        border-color: var(--primary-color);
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      .share-option i {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
        color: var(--text-secondary);
      }

      .share-option:hover i {
        color: var(--primary-color);
      }

      .share-option span {
        font-size: 0.875rem;
        color: var(--text-primary);
      }

      .share-link {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
      }

      .share-link input {
        flex: 1;
        padding: 0.75rem;
        border: 2px solid var(--surface);
        border-radius: 8px;
        font-size: 0.875rem;
      }

      .share-link button {
        padding: 0.75rem 1rem;
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: var(--transition);
      }

      .share-link button:hover {
        background: #cc001f;
      }

      /* Settings Modal - DIPERBAIKI */
      .settings-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        z-index: 4000;
        animation: fadeIn 0.3s ease;
        overflow-y: auto;
      }

      .settings-modal.active {
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding: 2rem 0;
      }

      .settings-container {
        background: white;
        border-radius: 16px;
        width: 90%;
        max-width: 800px;
        max-height: 85vh;
        overflow-y: auto;
        padding: 2rem;
        position: relative;
        animation: slideUp 0.3s ease;
        margin: auto 0;
      }

      .settings-header {
        text-align: center;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--surface);
        position: sticky;
        top: 0;
        background: white;
        z-index: 1;
      }

      .settings-header h2 {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
      }

      .settings-tabs {
        display: flex;
        gap: 0.25rem;
        margin-bottom: 2rem;
        background: var(--surface);
        border-radius: 12px;
        padding: 0.25rem;
        position: sticky;
        top: 120px;
        background: white;
        z-index: 1;
      }

      .settings-tab {
        flex: 1;
        padding: 1rem;
        background: transparent;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: var(--transition);
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }

      .settings-tab.active {
        background: white;
        color: var(--primary-color);
        box-shadow: var(--shadow-sm);
      }

      .settings-content {
        padding-bottom: 2rem;
      }

      .settings-form {
        display: block;
      }

      .settings-section {
        margin-bottom: 2rem;
      }

      .settings-section h3 {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--text-primary);
        margin-bottom: 1.5rem;
        font-size: 1.25rem;
      }

      .avatar-upload {
        display: flex;
        align-items: center;
        gap: 2rem;
        margin-bottom: 1rem;
      }

      .avatar-preview {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        overflow: hidden;
        border: 3px solid var(--primary-color);
      }

      .avatar-preview img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .form-actions {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
        padding-top: 1.5rem;
        border-top: 1px solid var(--surface);
        position: sticky;
        bottom: 0;
        background: white;
        padding-bottom: 1rem;
      }

      .form-actions .btn {
        flex: 1;
        justify-content: center;
      }

      .checkbox-group {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .checkbox-label {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
      }

      .checkbox-label input[type="checkbox"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
      }

      .danger-zone {
        margin-top: 3rem;
        padding: 1.5rem;
        background: #fee;
        border-radius: 8px;
        border: 2px solid #fcc;
      }

      .danger-zone h4 {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #dc2626;
        margin-bottom: 1rem;
      }

      .danger-actions {
        display: flex;
        gap: 1rem;
      }

      .btn-danger {
        background: #dc2626;
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .btn-danger:hover {
        background: #b91c1c;
        transform: translateY(-2px);
      }

      /* Saved Images Section */
      .saved-section {
        display: none;
        padding: 2rem;
        max-width: 1400px;
        margin: 0 auto;
      }

      .saved-section.active {
        display: block;
      }

      .my-boards-section {
        display: none;
        padding: 2rem;
        max-width: 1400px;
        margin: 0 auto;
      }

      .my-boards-section.active {
        display: block;
      }

      .board-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-top: 2rem;
      }

      .board-card {
        background: white;
        border-radius: var(--border-radius);
        overflow: hidden;
        box-shadow: var(--shadow-sm);
        transition: var(--transition);
        cursor: pointer;
        position: relative;
      }

      .board-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-lg);
      }

      .board-cover-img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        background: var(--surface);
      }

      .board-info {
        padding: 1rem;
      }

      .board-name {
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--text-primary);
      }

      .board-description {
        font-size: 0.875rem;
        color: var(--text-secondary);
        margin-bottom: 0.5rem;
      }

      .board-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.75rem;
        color: var(--text-secondary);
      }

      .create-board-card {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 200px;
        background: linear-gradient(135deg, #667eea10 0%, #764ba210 100%);
        border: 2px dashed var(--primary-color);
        border-radius: var(--border-radius);
        cursor: pointer;
        transition: var(--transition);
      }

      .create-board-card:hover {
        background: linear-gradient(135deg, #667eea20 0%, #764ba220 100%);
        border-color: #764ba2;
      }

      .create-board-content {
        text-align: center;
        padding: 2rem;
      }

      .create-board-content i {
        font-size: 3rem;
        color: var(--primary-color);
        margin-bottom: 1rem;
      }

      /* Create Board Modal - DIPERBAIKI */
      .create-board-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        z-index: 4000;
        animation: fadeIn 0.3s ease;
        overflow-y: auto;
      }

      .create-board-modal.active {
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding: 2rem 0;
      }

      .create-board-container {
        background: white;
        border-radius: 16px;
        width: 90%;
        max-width: 500px;
        max-height: 85vh;
        overflow-y: auto;
        padding: 2rem;
        position: relative;
        animation: slideUp 0.3s ease;
        margin: auto 0;
      }

      .create-board-header {
        text-align: center;
        margin-bottom: 2rem;
        position: sticky;
        top: 0;
        background: white;
        z-index: 1;
        padding-bottom: 1rem;
      }

      .create-board-cover {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-radius: var(--border-radius);
        margin-bottom: 1rem;
        background: var(--surface);
      }

      .cover-upload {
        text-align: center;
        margin-bottom: 2rem;
      }

      .cover-upload label {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: var(--surface);
        border-radius: var(--border-radius);
        cursor: pointer;
        transition: var(--transition);
      }

      .cover-upload label:hover {
        background: #ddd;
      }

      /* Board Detail Modal - DIPERBAIKI */
      .board-detail-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        z-index: 4000;
        animation: fadeIn 0.3s ease;
        overflow-y: auto;
      }

      .board-detail-modal.active {
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding: 2rem 0;
      }

      .board-detail-container {
        background: white;
        border-radius: 16px;
        width: 95%;
        max-width: 1200px;
        max-height: 90vh;
        overflow-y: auto;
        padding: 2rem;
        position: relative;
        animation: slideUp 0.3s ease;
        margin: auto 0;
      }

      .board-detail-header {
        display: flex;
        align-items: center;
        gap: 2rem;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--surface);
      }

      .board-detail-cover {
        width: 200px;
        height: 150px;
        object-fit: cover;
        border-radius: var(--border-radius);
      }

      .board-detail-info h2 {
        color: var(--text-primary);
        margin-bottom: 0.5rem;
      }

      .board-detail-info p {
        color: var(--text-secondary);
        margin-bottom: 1rem;
      }

      .board-stats {
        display: flex;
        gap: 2rem;
      }

      .board-stat {
        text-align: center;
      }

      .board-stat-value {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--primary-color);
      }

      .board-stat-label {
        font-size: 0.875rem;
        color: var(--text-secondary);
      }

      .board-actions {
        display: flex;
        gap: 0.5rem;
        margin-top: 1rem;
      }

      .board-actions .btn {
        padding: 0.5rem 1rem;
      }

      .board-images-grid {
        margin-top: 2rem;
      }

      /* Tab Navigation */
      .tab-navigation {
        display: flex;
        gap: 0.25rem;
        margin-bottom: 2rem;
        background: var(--surface);
        border-radius: 12px;
        padding: 0.25rem;
      }

      .tab-btn {
        flex: 1;
        padding: 0.75rem;
        background: transparent;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: var(--transition);
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }

      .tab-btn.active {
        background: white;
        color: var(--primary-color);
        box-shadow: var(--shadow-sm);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      /* Asset Detail Modal */
      .asset-detail-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.95);
        z-index: 4000;
        animation: fadeIn 0.3s ease;
        overflow-y: auto;
      }

      .asset-detail-modal.active {
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding: 2rem 0;
      }

      .asset-detail-container {
        width: 95%;
        max-width: 1400px;
        max-height: 90vh;
        background: white;
        border-radius: 16px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        animation: slideUp 0.3s ease;
        margin: auto 0;
      }

      .asset-detail-header {
        padding: 1.5rem 2rem;
        border-bottom: 1px solid var(--surface);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: white;
        position: sticky;
        top: 0;
        z-index: 10;
      }

      .asset-detail-title-section {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .asset-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
      }

      .asset-badge.premium {
        background: linear-gradient(135deg, #ffd700, #ffa500);
        color: #333;
      }

      .asset-badge.free {
        background: var(--primary-color);
        color: white;
      }

      .asset-detail-close {
        background: var(--surface);
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .asset-detail-close:hover {
        background: #ddd;
        transform: rotate(90deg);
      }

      .asset-detail-content {
        display: flex;
        flex: 1;
        overflow: hidden;
      }

      .asset-detail-left {
        flex: 1.5;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem;
        background: linear-gradient(45deg, #f0f0f0 25%, transparent 25%),
          linear-gradient(-45deg, #f0f0f0 25%, transparent 25%),
          linear-gradient(45deg, transparent 75%, #f0f0f0 75%),
          linear-gradient(-45deg, transparent 75%, #f0f0f0 75%);
        background-size: 20px 20px;
        background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        position: relative;
        overflow: hidden;
      }

      .asset-preview-container {
        position: relative;
        max-width: 100%;
        max-height: 100%;
      }

      .asset-preview {
        max-width: 100%;
        max-height: 60vh;
        object-fit: contain;
        box-shadow: var(--shadow-lg);
        border-radius: 8px;
        background: white;
      }

      .asset-detail-right {
        flex: 1;
        padding: 2rem;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 2rem;
      }

      .asset-stats {
        display: flex;
        gap: 2rem;
        padding: 1rem;
        background: var(--surface);
        border-radius: var(--border-radius);
      }

      .asset-stat {
        text-align: center;
        flex: 1;
      }

      .asset-stat-value {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--primary-color);
      }

      .asset-stat-label {
        font-size: 0.875rem;
        color: var(--text-secondary);
        margin-top: 0.25rem;
      }

      .premium-options {
        background: white;
        border-radius: var(--border-radius);
        padding: 1.5rem;
        box-shadow: var(--shadow-sm);
      }

      .premium-options h3 {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
        color: var(--text-primary);
      }

      .premium-options h3 i {
        color: #ffd700;
      }

      .options-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin-bottom: 1.5rem;
      }

      .option-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .option-group label {
        font-weight: 600;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .option-select {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid var(--surface);
        border-radius: 8px;
        font-size: 0.875rem;
        transition: var(--transition);
        cursor: pointer;
      }

      .option-select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(230, 0, 35, 0.1);
      }

      .option-radio-group {
        display: flex;
        gap: 1rem;
        margin-top: 0.5rem;
      }

      .option-radio {
        flex: 1;
      }

      .option-radio input[type="radio"] {
        display: none;
      }

      .option-radio label {
        display: block;
        padding: 0.75rem;
        border: 2px solid var(--surface);
        border-radius: 8px;
        text-align: center;
        cursor: pointer;
        transition: var(--transition);
        font-weight: normal;
      }

      .option-radio input[type="radio"]:checked + label {
        border-color: var(--primary-color);
        background: rgba(230, 0, 35, 0.1);
        font-weight: 600;
      }

      .asset-actions {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
      }

      .asset-action-btn {
        flex: 1;
        padding: 1rem;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }

      .asset-action-btn.primary {
        background: var(--primary-color);
        color: white;
      }

      .asset-action-btn.primary:hover {
        background: #cc001f;
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      .asset-action-btn.secondary {
        background: var(--surface);
        color: var(--text-primary);
      }

      .asset-action-btn.secondary:hover {
        background: #ddd;
        transform: translateY(-2px);
      }

      .asset-action-btn.favorite {
        background: transparent;
        border: 2px solid var(--surface);
        color: var(--text-primary);
      }

      .asset-action-btn.favorite:hover {
        border-color: #ffd700;
        color: #ffd700;
      }

      .asset-action-btn.favorite.active {
        background: #ffd700;
        border-color: #ffd700;
        color: #333;
      }

      .license-info {
        padding: 1.5rem;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: var(--border-radius);
        border-left: 4px solid var(--primary-color);
      }

      .license-info h4 {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.75rem;
        color: var(--text-primary);
      }

      .license-info p {
        font-size: 0.875rem;
        color: var(--text-secondary);
        line-height: 1.5;
      }

      .license-tag {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        background: white;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
        margin-top: 0.5rem;
        color: var(--primary-color);
        border: 1px solid var(--surface);
      }

      /* Mobile Detection Styles */
      .is-mobile .asset-detail-content {
        flex-direction: column;
      }

      .is-mobile .asset-detail-left {
        max-height: 40vh;
        padding: 1rem;
      }

      .is-mobile .asset-detail-right {
        padding: 1.5rem;
      }

      .is-mobile .asset-stats {
        flex-wrap: wrap;
      }

      .is-mobile .asset-stat {
        flex: none;
        width: calc(50% - 1rem);
      }

      .is-mobile .options-grid {
        grid-template-columns: 1fr;
      }

      .is-mobile .asset-actions {
        flex-direction: column;
      }

      /* Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      /* Responsive Design - DIPERBAIKI untuk modal */
      @media (max-width: 768px) {
        nav {
          padding: 0.75rem 1rem;
        }

        .hero h1 {
          font-size: 2rem;
        }

        .hero p {
          font-size: 1.1rem;
        }

        .hero-search-bar {
          padding: 0.875rem 2.5rem 0.875rem 1.25rem;
          font-size: 1rem;
        }

        .hero-search-btn {
          width: 36px;
          height: 36px;
          right: 8px;
        }

        .gallery-grid {
          grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
          gap: 1rem;
        }

        .profile-header {
          flex-direction: column;
          text-align: center;
        }

        .profile-info-grid {
          grid-template-columns: 1fr;
        }

        .image-detail-container {
          flex-direction: column;
          height: auto;
          max-height: 90vh;
        }

        .image-detail-left {
          flex: 1;
          max-height: 40vh;
        }

        .image-detail-right {
          max-height: 50vh;
        }

        .share-options {
          grid-template-columns: repeat(2, 1fr);
        }

        .toast {
          right: 1rem;
          left: 1rem;
          transform: translateY(100px);
        }

        .toast.show {
          transform: translateY(0);
        }

        .board-detail-header {
          flex-direction: column;
          text-align: center;
        }

        .board-detail-cover {
          width: 100%;
          height: 200px;
        }

        .board-grid {
          grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        }

        /* Asset Detail Responsive */
        .asset-detail-modal.active {
          padding: 0;
        }

        .asset-detail-container {
          width: 100%;
          height: 100vh;
          max-height: 100vh;
          border-radius: 0;
          margin: 0;
        }

        .asset-detail-content {
          flex-direction: column;
        }

        .asset-detail-left {
          max-height: 40vh;
          padding: 1rem;
        }

        .asset-detail-right {
          padding: 1.5rem;
          max-height: 60vh;
          overflow-y: auto;
        }

        .asset-stats {
          flex-wrap: wrap;
        }

        .asset-stat {
          flex: none;
          width: calc(50% - 1rem);
        }

        .options-grid {
          grid-template-columns: 1fr;
        }

        .asset-actions {
          flex-direction: column;
        }

        /* Perbaikan untuk modal di mobile */
        .auth-modal.active,
        .upload-modal.active,
        .settings-modal.active,
        .board-modal.active,
        .share-modal.active,
        .create-board-modal.active,
        .board-detail-modal.active,
        .image-detail-modal.active,
        .download-modal.active,
        .asset-detail-modal.active {
          padding: 1rem 0;
          align-items: flex-start;
        }

        .auth-container,
        .upload-container,
        .settings-container,
        .board-container,
        .share-container,
        .create-board-container,
        .board-detail-container,
        .download-container,
        .asset-detail-container {
          max-height: 90vh;
          margin: 0;
          padding: 1.5rem;
        }

        .image-detail-container,
        .asset-detail-container {
          max-height: 95vh;
        }

        /* Responsive untuk tombol */
        .btn span {
          display: inline;
        }

        .btn-back span {
          display: none;
        }

        .floating-back-btn {
          bottom: 1.5rem;
          right: 1.5rem;
          width: 50px;
          height: 50px;
        }

        .floating-download-btn {
          bottom: 60px;
          right: 1.5rem;
          width: 50px;
          height: 50px;
        }

        .image-download-btn {
          padding: 8px 16px;
          font-size: 0.8rem;
        }

        .page-header {
          flex-direction: column;
          gap: 1rem;
          align-items: flex-start;
        }

        .page-actions {
          width: 100%;
          justify-content: space-between;
        }
      }

      /* Empty State */
      .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: var(--text-secondary);
      }

      .empty-state i {
        font-size: 4rem;
        margin-bottom: 1rem;
        opacity: 0.5;
      }

      .empty-state h3 {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
        color: var(--text-primary);
      }

      /* Filter Bar */
      .filter-bar {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
        align-items: center;
      }

      .filter-select {
        padding: 0.5rem 1rem;
        border-radius: var(--border-radius);
        border: 1px solid var(--surface);
        background: white;
        cursor: pointer;
        transition: var(--transition);
      }

      .filter-select:focus {
        outline: none;
        border-color: var(--primary-color);
      }

      /* Call to Action Box */
      .cta-box {
        background: linear-gradient(135deg, var(--primary-color), #cc001f);
        color: white;
        padding: 2rem;
        border-radius: var(--border-radius);
        text-align: center;
        margin: 2rem auto;
        max-width: 600px;
        box-shadow: var(--shadow-lg);
      }

      .cta-box h3 {
        font-size: 1.5rem;
        margin-bottom: 1rem;
      }

      .cta-box p {
        margin-bottom: 1.5rem;
        opacity: 0.95;
      }

      .cta-btn {
        background: white;
        color: var(--primary-color);
        padding: 0.875rem 2rem;
        border: none;
        border-radius: 24px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
      }

      .cta-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }

      /* Gallery CTA */
      .gallery-cta {
        margin: 4rem auto 2rem;
        max-width: 800px;
        animation: fadeInUp 0.8s ease;
        border-radius: var(--border-radius);
        padding: 3rem;
        background: linear-gradient(135deg, var(--primary-color), #cc001f);
        color: white;
        text-align: center;
        box-shadow: var(--shadow-lg);
      }

      .gallery-cta h3 {
        font-size: 1.75rem;
        margin-bottom: 1rem;
      }

      .gallery-cta p {
        font-size: 1.1rem;
        margin-bottom: 2rem;
        opacity: 0.95;
      }

      .gallery-cta .cta-btn {
        background: white;
        color: var(--primary-color);
        padding: 1rem 2.5rem;
        font-size: 1.1rem;
        font-weight: 600;
        border-radius: 30px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
      }

      .gallery-cta .cta-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
      }

      /* Scroll lock untuk body saat modal terbuka */
      body.modal-open {
        overflow: hidden;
      }

      /* Toast Notification */
      .toast {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        background: white;
        color: var(--text-primary);
        padding: 1rem 1.5rem;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-lg);
        display: flex;
        align-items: center;
        gap: 0.75rem;
        z-index: 5000;
        opacity: 0;
        transform: translateY(100px);
        transition: var(--transition);
      }

      .toast.show {
        opacity: 1;
        transform: translateY(0);
      }

      .toast.success {
        border-left: 4px solid #10b981;
      }

      .toast.error {
        border-left: 4px solid #ef4444;
      }

      .toast i {
        font-size: 1.25rem;
      }

      .toast.success i {
        color: #10b981;
      }

      .toast.error i {
        color: #ef4444;
      }

      /* Quick Back Button */
      .quick-back-btn {
        position: fixed;
        top: 1rem;
        left: 1rem;
        background: rgba(255, 255, 255, 0.9);
        border: 1px solid var(--surface);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 100;
        box-shadow: var(--shadow-md);
        transition: var(--transition);
      }

      .quick-back-btn:hover {
        background: white;
        transform: scale(1.1);
        box-shadow: var(--shadow-lg);
      }

      .quick-back-btn i {
        font-size: 1.2rem;
        color: var(--primary-color);
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header>
      <nav>
        <div class="logo" onclick="showHome()">
          <i class="fas fa-images"></i>
          <span>PinGallery</span>
        </div>

        <div class="nav-actions" id="navActions">
          <!-- Dynamic content based on login state -->
        </div>
      </nav>
    </header>

    <!-- Quick Back Button (akan muncul di halaman khusus) -->
    <button
      class="quick-back-btn"
      id="quickBackBtn"
      onclick="showHome()"
      style="display: none"
    >
      <i class="fas fa-arrow-left"></i>
    </button>

    <!-- Hero Section dengan Search Bar -->
    <section class="hero" id="heroSection">
      <div class="hero-content">
        <h1 id="heroTitle">Temukan & Bagikan Inspirasi Visual</h1>
        <p id="heroSubtitle">
          Platform berbagi gambar dengan jutaan koleksi dari seluruh dunia
        </p>

        <!-- Search Bar dipindahkan ke sini -->
        <div class="hero-search-container">
          <input
            type="text"
            class="hero-search-bar"
            id="searchInput"
            placeholder="Cari gambar, kategori, atau tag..."
          />
          <button class="hero-search-btn" onclick="searchImages()">
            <i class="fas fa-search"></i>
          </button>
        </div>

        <div id="heroActions">
          <!-- Dynamic CTA based on login state -->
        </div>
      </div>
    </section>

    <!-- Profile Section -->
    <section class="profile-section" id="profileSection">
      <div class="page-header">
        <div class="page-title">
          <i
            class="fas fa-user-circle"
            style="font-size: 2rem; color: var(--primary-color)"
          ></i>
          <h2>Profil Saya</h2>
        </div>
        <div class="page-actions">
          <button class="btn btn-secondary" onclick="showHome()">
            <i class="fas fa-times"></i>
            <span>Keluar</span>
          </button>
        </div>
      </div>

      <div class="profile-header">
        <img
          class="profile-avatar"
          id="profileAvatar"
          src="https://picsum.photos/seed/avatar1/200/200.jpg"
          alt="Profile"
        />
        <div class="profile-info">
          <h2 id="profileName">Nama Pengguna</h2>
          <p id="profileEmail">email@example.com</p>
          <div class="profile-stats">
            <div class="profile-stat">
              <div class="profile-stat-value" id="userImagesCount">0</div>
              <div class="profile-stat-label">Gambar</div>
            </div>
            <div class="profile-stat">
              <div class="profile-stat-value" id="userLikesCount">0</div>
              <div class="profile-stat-label">Suka</div>
            </div>
            <div class="profile-stat">
              <div class="profile-stat-value" id="userSavesCount">0</div>
              <div class="profile-stat-label">Simpan</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Profile Info Toggle -->
      <div class="profile-info-toggle" onclick="toggleProfileDetails()">
        <div class="toggle-header">
          <i class="fas fa-info-circle" style="color: var(--primary-color)"></i>
          <h4>Informasi Profil Lengkap</h4>
        </div>
        <i class="fas fa-chevron-down toggle-arrow" id="profileToggleArrow"></i>
      </div>

      <!-- Profile Details Section -->
      <div class="profile-details-section" id="profileDetailsSection">
        <div class="profile-details-header">
          <h3>
            <i class="fas fa-id-card"></i>
            Informasi Profil
          </h3>
          <button class="edit-details-btn" onclick="editProfileInfo()">
            <i class="fas fa-edit"></i>
            Edit
          </button>
        </div>

        <div class="profile-info-grid">
          <div class="info-item">
            <div class="info-label">
              <i class="fas fa-user"></i>
              Nama Lengkap
            </div>
            <div class="info-value" id="profileDetailName">-</div>
          </div>

          <div class="info-item">
            <div class="info-label">
              <i class="fas fa-at"></i>
              Username
            </div>
            <div class="info-value" id="profileDetailUsername">-</div>
          </div>

          <div class="info-item">
            <div class="info-label">
              <i class="fas fa-envelope"></i>
              Email
            </div>
            <div class="info-value" id="profileDetailEmail">-</div>
          </div>

          <div class="info-item">
            <div class="info-label">
              <i class="fas fa-map-marker-alt"></i>
              Lokasi
            </div>
            <div class="info-value" id="profileDetailLocation">-</div>
          </div>

          <div class="info-item">
            <div class="info-label">
              <i class="fas fa-globe"></i>
              Website
            </div>
            <div class="info-value" id="profileDetailWebsite">-</div>
          </div>

          <div class="info-item">
            <div class="info-label">
              <i class="fas fa-calendar-alt"></i>
              Bergabung Sejak
            </div>
            <div class="info-value" id="profileDetailJoined">-</div>
          </div>
        </div>

        <div class="profile-bio">
          <div class="info-label">
            <i class="fas fa-align-left"></i>
            Bio
          </div>
          <div class="info-value bio-content" id="profileDetailBio">-</div>
        </div>
      </div>

      <!-- Upload Section in Profile -->
      <div class="profile-upload-section">
        <h3 class="section-title">
          <i class="fas fa-cloud-upload-alt"></i>
          Unggah Gambar Baru
        </h3>
        <div
          class="upload-area"
          id="uploadArea"
          onclick="document.getElementById('fileInput').click()"
        >
          <i class="fas fa-cloud-upload-alt upload-icon"></i>
          <h2>Unggah Gambar Anda</h2>
          <p>Drag & drop gambar di sini atau klik untuk memilih file</p>
          <p style="color: var(--text-secondary); margin-top: 1rem">
            Mendukung: PNG, JPG, JPEG, GIF, WebP, SVG (Maks. 10MB)
          </p>
          <input
            type="file"
            id="fileInput"
            accept="image/*"
            multiple
            onchange="handleFileSelect(event)"
          />
        </div>
      </div>
    </section>

    <!-- Categories -->
    <section class="categories" id="categoriesSection">
      <div class="category-pills">
        <div class="category-pill active" onclick="filterByCategory('all')">
          Semua
        </div>
        <div class="category-pill" onclick="filterByCategory('nature')">
          Alam
        </div>
        <div class="category-pill" onclick="filterByCategory('architecture')">
          Arsitektur
        </div>
        <div class="category-pill" onclick="filterByCategory('people')">
          Orang
        </div>
        <div class="category-pill" onclick="filterByCategory('technology')">
          Teknologi
        </div>
        <div class="category-pill" onclick="filterByCategory('animals')">
          Hewan
        </div>
        <div class="category-pill" onclick="filterByCategory('food')">
          Makanan
        </div>
        <div class="category-pill" onclick="filterByCategory('travel')">
          Travel
        </div>
        <div class="category-pill" onclick="filterByCategory('art')">Seni</div>
        <div class="category-pill" onclick="filterByCategory('fashion')">
          Fashion
        </div>
        <div class="category-pill" onclick="filterByCategory('design')">
          Desain
        </div>
        <div class="category-pill" onclick="filterByCategory('aesthetic')">
          Estetika
        </div>
      </div>
    </section>

    <!-- Gallery Section -->
    <section class="gallery-section" id="gallerySection">
      <div class="gallery-header">
        <h2 id="galleryTitle">Galeri Gambar</h2>
        <div class="view-options">
          <button
            class="view-btn active"
            onclick="setViewMode('grid')"
            title="Grid View"
          >
            <i class="fas fa-th"></i>
          </button>
          <button
            class="view-btn"
            onclick="setViewMode('masonry')"
            title="Masonry View"
          >
            <i class="fas fa-th-large"></i>
          </button>
        </div>
      </div>

      <div class="filter-bar">
        <select class="filter-select" onchange="sortImages(this.value)">
          <option value="newest">Terbaru</option>
          <option value="popular">Terpopuler</option>
          <option value="oldest">Terlama</option>
          <option value="name">Nama (A-Z)</option>
        </select>
        <select class="filter-select" onchange="filterByFormat(this.value)">
          <option value="all">Semua Format</option>
          <option value="png">PNG</option>
          <option value="jpg">JPG</option>
          <option value="gif">GIF</option>
          <option value="webp">WebP</option>
          <option value="svg">SVG</option>
        </select>
      </div>

      <div class="gallery-grid" id="galleryGrid">
        <!-- Images will be dynamically added here -->
      </div>

      <div class="empty-state" id="emptyState" style="display: none">
        <i class="fas fa-images"></i>
        <h3>Belum ada gambar</h3>
        <p id="emptyStateMessage">Unggah gambar pertama Anda untuk memulai</p>
      </div>

      <!-- CTA Section untuk Guest Users -->
      <div class="cta-box gallery-cta" id="ctaBox" style="display: none">
        <h3>Siap Berbagi Karya Anda?</h3>
        <p>
          Bergabunglah dengan komunitas kreator visual dan mulai unggah karya
          terbaik Anda
        </p>
        <button class="cta-btn" onclick="showAuthModal()">
          <i class="fas fa-rocket"></i>
          <span>Daftar Sekarang</span>
        </button>
      </div>
    </section>

    <!-- Saved Images Section -->
    <section class="saved-section" id="savedSection">
      <div class="page-header">
        <div class="page-title">
          <i
            class="fas fa-bookmark"
            style="font-size: 2rem; color: var(--primary-color)"
          ></i>
          <h2>Gambar Tersimpan</h2>
        </div>
        <div class="page-actions">
          <button class="btn btn-secondary" onclick="showHome()">
            <i class="fas fa-times"></i>
            <span>Keluar</span>
          </button>
        </div>
      </div>

      <div class="tab-navigation">
        <button class="tab-btn active" onclick="switchSavedTab('boards')">
          <i class="fas fa-bookmark"></i> Semua Board
        </button>
        <button class="tab-btn" onclick="switchSavedTab('all')">
          <i class="fas fa-images"></i> Semua Gambar
        </button>
      </div>

      <div class="tab-content active" id="savedBoardsTab">
        <div class="board-grid" id="savedBoardsGrid">
          <!-- Boards will be added here -->
        </div>
      </div>

      <div class="tab-content" id="savedAllTab">
        <div class="gallery-grid" id="savedImagesGrid">
          <!-- Saved images will be added here -->
        </div>
        <div class="empty-state" id="savedEmptyState">
          <i class="fas fa-bookmark"></i>
          <h3>Belum ada gambar tersimpan</h3>
          <p>Simpan gambar favorit Anda untuk dilihat nanti</p>
        </div>
      </div>
    </section>

    <!-- My Boards Section -->
    <section class="my-boards-section" id="myBoardsSection">
      <div class="page-header">
        <div class="page-title">
          <i
            class="fas fa-layer-group"
            style="font-size: 2rem; color: var(--primary-color)"
          ></i>
          <h2>Board Saya</h2>
        </div>
        <div class="page-actions">
          <button class="btn btn-primary" onclick="openCreateBoardModal()">
            <i class="fas fa-plus"></i> Board Baru
          </button>
          <button class="btn btn-secondary" onclick="showHome()">
            <i class="fas fa-times"></i>
            <span>Keluar</span>
          </button>
        </div>
      </div>

      <div class="board-grid" id="myBoardsGrid">
        <!-- My boards will be added here -->
      </div>
    </section>

    <!-- Auth Modal -->
    <div class="auth-modal" id="authModal">
      <div class="auth-container">
        <button class="auth-close" onclick="closeAuthModal()">
          <i class="fas fa-times"></i>
        </button>

        <div class="auth-header">
          <h2>Selamat Datang di PinGallery</h2>
          <p>Bergabunglah dengan jutaan kreator visual</p>
        </div>

        <div class="auth-tabs">
          <button class="auth-tab active" onclick="switchAuthTab('login')">
            Masuk
          </button>
          <button class="auth-tab" onclick="switchAuthTab('register')">
            Daftar
          </button>
        </div>

        <!-- Login Form -->
        <form id="loginForm" onsubmit="handleLogin(event)">
          <div class="form-group">
            <label class="form-label">Email</label>
            <input
              type="email"
              class="form-input"
              id="loginEmail"
              placeholder="email@example.com"
              required
            />
            <span class="error-message" id="loginEmailError"
              >Email tidak valid</span
            >
          </div>

          <div class="form-group">
            <label class="form-label">Password</label>
            <div class="password-wrapper">
              <input
                type="password"
                class="form-input"
                id="loginPassword"
                placeholder="Masukkan password"
                required
              />
              <button
                type="button"
                class="password-toggle"
                onclick="togglePassword('loginPassword')"
              >
                <i class="fas fa-eye"></i>
              </button>
            </div>
            <span class="error-message" id="loginPasswordError"
              >Password minimal 6 karakter</span
            >
          </div>

          <button type="submit" class="auth-submit" id="loginSubmit">
            Masuk
          </button>
        </form>

        <!-- Register Form -->
        <form
          id="registerForm"
          style="display: none"
          onsubmit="handleRegister(event)"
        >
          <div class="form-group">
            <label class="form-label">Nama Lengkap</label>
            <input
              type="text"
              class="form-input"
              id="registerName"
              placeholder="John Doe"
              required
            />
            <span class="error-message" id="registerNameError"
              >Nama harus diisi</span
            >
          </div>

          <div class="form-group">
            <label class="form-label">Email</label>
            <input
              type="email"
              class="form-input"
              id="registerEmail"
              placeholder="email@example.com"
              required
            />
            <span class="error-message" id="registerEmailError"
              >Email tidak valid</span
            >
          </div>

          <div class="form-group">
            <label class="form-label">Password</label>
            <div class="password-wrapper">
              <input
                type="password"
                class="form-input"
                id="registerPassword"
                placeholder="Minimal 6 karakter"
                required
              />
              <button
                type="button"
                class="password-toggle"
                onclick="togglePassword('registerPassword')"
              >
                <i class="fas fa-eye"></i>
              </button>
            </div>
            <span class="error-message" id="registerPasswordError"
              >Password minimal 6 karakter</span
            >
          </div>

          <div class="form-group">
            <label class="form-label">Konfirmasi Password</label>
            <div class="password-wrapper">
              <input
                type="password"
                class="form-input"
                id="registerConfirmPassword"
                placeholder="Konfirmasi password"
                required
              />
              <button
                type="button"
                class="password-toggle"
                onclick="togglePassword('registerConfirmPassword')"
              >
                <i class="fas fa-eye"></i>
              </button>
            </div>
            <span class="error-message" id="registerConfirmPasswordError"
              >Password tidak cocok</span
            >
          </div>

          <button type="submit" class="auth-submit" id="registerSubmit">
            Daftar
          </button>
        </form>

        <div class="auth-divider">
          <span>atau lanjutkan dengan</span>
        </div>

        <div class="social-login">
          <button class="social-btn" onclick="socialLogin('google')">
            <i class="fab fa-google"></i>
            Google
          </button>
          <button class="social-btn" onclick="socialLogin('facebook')">
            <i class="fab fa-facebook"></i>
            Facebook
          </button>
        </div>
      </div>
    </div>

    <!-- Upload Modal -->
    <div class="upload-modal" id="uploadModal">
      <div class="upload-container">
        <button class="auth-close" onclick="closeUploadModal()">
          <i class="fas fa-times"></i>
        </button>

        <div class="upload-header">
          <h2>Detail Gambar</h2>
          <p>Lengkapi informasi gambar Anda</p>
        </div>

        <form id="uploadForm" onsubmit="handleUploadSubmit(event)">
          <div class="upload-preview" id="uploadPreview">
            <img id="previewImage" src="" alt="Preview" />
          </div>

          <div class="form-group">
            <label class="form-label">Judul Gambar *</label>
            <input
              type="text"
              class="form-input"
              id="imageTitle"
              placeholder="Masukkan judul gambar"
              required
            />
            <span class="error-message" id="titleError">Judul harus diisi</span>
          </div>

          <div class="form-group">
            <label class="form-label">Deskripsi</label>
            <textarea
              class="form-textarea"
              id="imageDescription"
              placeholder="Tambahkan deskripsi (opsional)"
            ></textarea>
          </div>

          <div class="form-group">
            <label class="form-label">Kategori *</label>
            <select class="form-select" id="imageCategory" required>
              <option value="">Pilih kategori</option>
              <option value="nature">Alam</option>
              <option value="architecture">Arsitektur</option>
              <option value="people">Orang</option>
              <option value="technology">Teknologi</option>
              <option value="animals">Hewan</option>
              <option value="food">Makanan</option>
              <option value="travel">Travel</option>
              <option value="art">Seni</option>
              <option value="fashion">Fashion</option>
              <option value="design">Desain</option>
              <option value="aesthetic">Estetika</option>
            </select>
            <span class="error-message" id="categoryError"
              >Kategori harus dipilih</span
            >
          </div>

          <div class="form-group">
            <label class="form-label">Tag</label>
            <div class="tags-input-container">
              <input
                type="text"
                class="form-input"
                id="tagInput"
                placeholder="Tambahkan tag dan tekan Enter"
              />
              <div class="tags-display" id="tagsDisplay"></div>
            </div>
          </div>

          <div class="upload-actions">
            <button
              type="button"
              class="btn btn-secondary"
              onclick="closeUploadModal()"
            >
              <i class="fas fa-times"></i>
              Batal
            </button>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-upload"></i>
              Unggah
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Enhanced Image Detail Modal -->
    <div class="image-detail-modal" id="imageDetailModal">
      <div class="image-detail-container">
        <div class="image-detail-left">
          <button class="image-detail-close" onclick="closeImageDetail()">
            <i class="fas fa-times"></i>
          </button>
          <img
            class="image-detail-img"
            id="detailImage"
            src=""
            alt=""
            onclick="toggleZoom()"
          />
          <!-- Tombol Download di atas gambar -->
          <button
            class="image-download-btn"
            id="imageDownloadBtn"
            onclick="showDownloadOptions()"
          >
            <i class="fas fa-download"></i> Download
          </button>
        </div>
        <div class="image-detail-right">
          <div class="image-detail-header">
            <h2 class="image-detail-title" id="detailTitle"></h2>
            <div class="image-detail-meta">
              <div class="image-detail-author">
                <img
                  class="author-avatar"
                  id="authorAvatar"
                  src=""
                  alt="Author"
                />
                <span id="authorName"></span>
              </div>
              <span id="uploadDate"></span>
            </div>
          </div>

          <div class="image-detail-actions">
            <button
              class="detail-action-btn"
              id="detailLikeBtn"
              onclick="toggleLike()"
            >
              <i class="fas fa-heart"></i>
              <span id="detailLikeCount">0</span>
            </button>
            <button
              class="detail-action-btn"
              id="detailSaveBtn"
              onclick="openBoardModal()"
            >
              <i class="fas fa-bookmark"></i>
              Simpan
            </button>
            <button
              class="detail-action-btn primary"
              onclick="showDownloadOptions()"
            >
              <i class="fas fa-download"></i>
              Unduh
            </button>
            <button class="detail-action-btn" onclick="openShareModal()">
              <i class="fas fa-share"></i>
              Bagikan
            </button>
          </div>

          <div class="image-detail-info">
            <div class="info-section">
              <div class="info-label">
                <i class="fas fa-align-left"></i>
                Deskripsi
              </div>
              <div class="info-content" id="detailDescription">
                Tidak ada deskripsi
              </div>
            </div>

            <div class="info-section">
              <div class="info-label">
                <i class="fas fa-folder"></i>
                Kategori
              </div>
              <div class="info-content">
                <span class="detail-tag" id="detailCategory"></span>
              </div>
            </div>

            <div class="info-section">
              <div class="info-label">
                <i class="fas fa-tags"></i>
                Tag
              </div>
              <div class="image-detail-tags" id="detailTags">
                <!-- Tags will be added dynamically -->
              </div>
            </div>

            <div class="info-section">
              <div class="info-label">
                <i class="fas fa-info-circle"></i>
                Informasi File
              </div>
              <div class="file-info">
                <div class="file-info-item">
                  <i class="fas fa-file"></i>
                  <span id="fileFormat"></span>
                </div>
                <div class="file-info-item">
                  <i class="fas fa-weight"></i>
                  <span id="fileSize"></span>
                </div>
                <div class="file-info-item">
                  <i class="fas fa-expand"></i>
                  <span id="fileDimensions"></span>
                </div>
                <div class="file-info-item">
                  <i class="fas fa-eye"></i>
                  <span id="viewCount">0</span> dilihat
                </div>
                <div class="file-info-item">
                  <i class="fas fa-download"></i>
                  <span id="downloadCount">0</span> download
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Download Options Modal -->
    <div class="download-modal" id="downloadModal">
      <div class="download-container">
        <button class="auth-close" onclick="closeDownloadModal()">
          <i class="fas fa-times"></i>
        </button>

        <div class="download-header">
          <h3><i class="fas fa-download"></i> Unduh Gambar</h3>
          <p>Pilih kualitas yang diinginkan</p>
        </div>

        <div class="download-options" id="downloadOptions">
          <!-- Download options will be added dynamically -->
        </div>
      </div>
    </div>

    <!-- Board Modal -->
    <div class="board-modal" id="boardModal">
      <div class="board-container">
        <button class="auth-close" onclick="closeBoardModal()">
          <i class="fas fa-times"></i>
        </button>

        <div class="board-header">
          <h3>Simpan ke Board</h3>
          <p>Pilih board untuk menyimpan gambar ini</p>
        </div>

        <div class="boards-list" id="boardsList">
          <!-- Boards will be added dynamically -->
        </div>

        <button class="create-board" onclick="createNewBoard()">
          <i class="fas fa-plus"></i>
          Buat Board Baru
        </button>

        <div class="board-actions">
          <button class="btn btn-secondary" onclick="closeBoardModal()">
            Batal
          </button>
          <button class="btn btn-primary" onclick="saveToBoard()">
            Simpan
          </button>
        </div>
      </div>
    </div>

    <!-- Share Modal -->
    <div class="share-modal" id="shareModal">
      <div class="share-container">
        <button class="auth-close" onclick="closeShareModal()">
          <i class="fas fa-times"></i>
        </button>

        <div class="share-header">
          <h3>Bagikan Gambar</h3>
          <p>Bagikan karya ini ke platform favorit Anda</p>
        </div>

        <div class="share-options">
          <div class="share-option" onclick="shareToSocial('facebook')">
            <i class="fab fa-facebook" style="color: #1877f2"></i>
            <span>Facebook</span>
          </div>
          <div class="share-option" onclick="shareToSocial('twitter')">
            <i class="fab fa-twitter" style="color: #1da1f2"></i>
            <span>Twitter</span>
          </div>
          <div class="share-option" onclick="shareToSocial('instagram')">
            <i class="fab fa-instagram" style="color: #e4405f"></i>
            <span>Instagram</span>
          </div>
          <div class="share-option" onclick="shareToSocial('whatsapp')">
            <i class="fab fa-whatsapp" style="color: #25d366"></i>
            <span>WhatsApp</span>
          </div>
          <div class="share-option" onclick="shareToSocial('telegram')">
            <i class="fab fa-telegram" style="color: #0088cc"></i>
            <span>Telegram</span>
          </div>
          <div class="share-option" onclick="shareToSocial('email')">
            <i class="fas fa-envelope" style="color: #ea4335"></i>
            <span>Email</span>
          </div>
        </div>

        <div class="share-link">
          <input type="text" id="shareLink" readonly value="" />
          <button onclick="copyShareLink()">
            <i class="fas fa-copy"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div class="settings-modal" id="settingsModal">
      <div class="settings-container">
        <button class="auth-close" onclick="closeSettingsModal()">
          <i class="fas fa-times"></i>
        </button>

        <div class="settings-header">
          <h2><i class="fas fa-cog"></i> Pengaturan Akun</h2>
          <p>Kelola preferensi dan informasi akun Anda</p>
        </div>

        <div class="settings-tabs">
          <button
            class="settings-tab active"
            onclick="switchSettingsTab('profile')"
          >
            <i class="fas fa-user"></i> Profil
          </button>
          <button class="settings-tab" onclick="switchSettingsTab('account')">
            <i class="fas fa-lock"></i> Keamanan
          </button>
          <button
            class="settings-tab"
            onclick="switchSettingsTab('preferences')"
          >
            <i class="fas fa-sliders-h"></i> Preferensi
          </button>
        </div>

        <div class="settings-content">
          <!-- Profile Settings -->
          <form
            id="profileSettings"
            class="settings-form"
            onsubmit="updateProfile(event)"
          >
            <div class="settings-section">
              <h3><i class="fas fa-user-circle"></i> Informasi Profil</h3>

              <div class="form-group">
                <label class="form-label">Foto Profil</label>
                <div class="avatar-upload">
                  <div class="avatar-preview">
                    <img id="settingsAvatar" src="" alt="Avatar" />
                  </div>
                  <input
                    type="file"
                    id="avatarUpload"
                    accept="image/*"
                    style="display: none"
                    onchange="handleAvatarUpload(event)"
                  />
                  <button
                    type="button"
                    class="btn btn-secondary"
                    onclick="document.getElementById('avatarUpload').click()"
                  >
                    <i class="fas fa-camera"></i> Ubah Foto
                  </button>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Nama Lengkap *</label>
                <input
                  type="text"
                  class="form-input"
                  id="settingsName"
                  required
                />
              </div>

              <div class="form-group">
                <label class="form-label">Username *</label>
                <input
                  type="text"
                  class="form-input"
                  id="settingsUsername"
                  required
                />
              </div>

              <div class="form-group">
                <label class="form-label">Bio</label>
                <textarea
                  class="form-textarea"
                  id="settingsBio"
                  placeholder="Ceritakan tentang diri Anda"
                  rows="3"
                ></textarea>
              </div>

              <div class="form-group">
                <label class="form-label">Website</label>
                <input
                  type="url"
                  class="form-input"
                  id="settingsWebsite"
                  placeholder="https://"
                />
              </div>

              <div class="form-group">
                <label class="form-label">Lokasi</label>
                <input
                  type="text"
                  class="form-input"
                  id="settingsLocation"
                  placeholder="Kota, Negara"
                />
              </div>

              <div class="form-actions">
                <button
                  type="button"
                  class="btn btn-secondary"
                  onclick="closeSettingsModal()"
                >
                  Batal
                </button>
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-save"></i> Simpan Perubahan
                </button>
              </div>
            </div>
          </form>

          <!-- Account Settings -->
          <form
            id="accountSettings"
            class="settings-form"
            style="display: none"
            onsubmit="updateAccountSettings(event)"
          >
            <div class="settings-section">
              <h3><i class="fas fa-lock"></i> Keamanan Akun</h3>

              <div class="form-group">
                <label class="form-label">Email *</label>
                <input
                  type="email"
                  class="form-input"
                  id="settingsEmail"
                  required
                />
              </div>

              <div class="form-group">
                <label class="form-label">Password Lama</label>
                <div class="password-wrapper">
                  <input
                    type="password"
                    class="form-input"
                    id="settingsCurrentPassword"
                    placeholder="Masukkan password lama"
                  />
                  <button
                    type="button"
                    class="password-toggle"
                    onclick="togglePassword('settingsCurrentPassword')"
                  >
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Password Baru</label>
                <div class="password-wrapper">
                  <input
                    type="password"
                    class="form-input"
                    id="settingsNewPassword"
                    placeholder="Minimal 6 karakter"
                  />
                  <button
                    type="button"
                    class="password-toggle"
                    onclick="togglePassword('settingsNewPassword')"
                  >
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Konfirmasi Password Baru</label>
                <div class="password-wrapper">
                  <input
                    type="password"
                    class="form-input"
                    id="settingsConfirmPassword"
                    placeholder="Konfirmasi password baru"
                  />
                  <button
                    type="button"
                    class="password-toggle"
                    onclick="togglePassword('settingsConfirmPassword')"
                  >
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
              </div>

              <div class="form-actions">
                <button
                  type="button"
                  class="btn btn-secondary"
                  onclick="closeSettingsModal()"
                >
                  Batal
                </button>
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-key"></i> Perbarui Keamanan
                </button>
              </div>
            </div>
          </form>

          <!-- Preferences Settings -->
          <form
            id="preferencesSettings"
            class="settings-form"
            style="display: none"
            onsubmit="updatePreferences(event)"
          >
            <div class="settings-section">
              <h3><i class="fas fa-sliders-h"></i> Preferensi Aplikasi</h3>

              <div class="form-group">
                <label class="form-label">Bahasa</label>
                <select class="form-select" id="settingsLanguage">
                  <option value="id">Bahasa Indonesia</option>
                  <option value="en">English</option>
                </select>
              </div>

              <div class="form-group">
                <label class="form-label">Tema</label>
                <select class="form-select" id="settingsTheme">
                  <option value="light">Terang</option>
                  <option value="dark">Gelap</option>
                  <option value="auto">Otomatis</option>
                </select>
              </div>

              <div class="form-group">
                <label class="form-label">Notifikasi Email</label>
                <div class="checkbox-group">
                  <label class="checkbox-label">
                    <input
                      type="checkbox"
                      id="settingsNotificationsEmail"
                      checked
                    />
                    <span>Kirim notifikasi via email</span>
                  </label>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Privasi</label>
                <div class="checkbox-group">
                  <label class="checkbox-label">
                    <input type="checkbox" id="settingsProfilePublic" checked />
                    <span>Profil publik</span>
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="settingsShowEmail" />
                    <span>Tampilkan email di profil</span>
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="settingsAllowTagging" checked />
                    <span>Izinkan penandaan</span>
                  </label>
                </div>
              </div>

              <div class="danger-zone">
                <h4><i class="fas fa-exclamation-triangle"></i> Zona Bahaya</h4>
                <div class="danger-actions">
                  <button
                    type="button"
                    class="btn btn-danger"
                    onclick="exportData()"
                  >
                    <i class="fas fa-download"></i> Ekspor Data
                  </button>
                  <button
                    type="button"
                    class="btn btn-danger"
                    onclick="requestAccountDeletion()"
                  >
                    <i class="fas fa-trash"></i> Hapus Akun
                  </button>
                </div>
              </div>

              <div class="form-actions">
                <button
                  type="button"
                  class="btn btn-secondary"
                  onclick="closeSettingsModal()"
                >
                  Batal
                </button>
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-save"></i> Simpan Preferensi
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Create Board Modal -->
    <div class="create-board-modal" id="createBoardModal">
      <div class="create-board-container">
        <button class="auth-close" onclick="closeCreateBoardModal()">
          <i class="fas fa-times"></i>
        </button>

        <div class="create-board-header">
          <h2><i class="fas fa-plus"></i> Buat Board Baru</h2>
          <p>Kumpulkan dan organisir gambar favorit Anda</p>
        </div>

        <form onsubmit="createBoardSubmit(event)">
          <div class="form-group">
            <label class="form-label">Nama Board *</label>
            <input
              type="text"
              class="form-input"
              id="boardName"
              placeholder="Nama board"
              required
            />
          </div>

          <div class="form-group">
            <label class="form-label">Deskripsi</label>
            <textarea
              class="form-textarea"
              id="boardDescription"
              placeholder="Deskripsi board (opsional)"
              rows="3"
            ></textarea>
          </div>

          <div class="form-group">
            <label class="form-label">Cover Board</label>
            <div class="cover-upload">
              <img
                class="create-board-cover"
                id="boardCoverPreview"
                src="https://picsum.photos/seed/board/600/400.jpg"
                alt="Cover Preview"
              />
              <input
                type="file"
                id="boardCover"
                accept="image/*"
                style="display: none"
                onchange="handleBoardCover(event)"
              />
              <label for="boardCover">
                <i class="fas fa-camera"></i> Pilih Cover
              </label>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Privasi</label>
            <div class="checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" id="boardPrivate" />
                <span>Board pribadi (hanya Anda yang bisa melihat)</span>
              </label>
            </div>
          </div>

          <div class="form-actions">
            <button
              type="button"
              class="btn btn-secondary"
              onclick="closeCreateBoardModal()"
            >
              Batal
            </button>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-plus"></i> Buat Board
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Board Detail Modal -->
    <div class="board-detail-modal" id="boardDetailModal">
      <div class="board-detail-container">
        <button class="auth-close" onclick="closeBoardDetail()">
          <i class="fas fa-times"></i>
        </button>

        <div class="board-detail-header">
          <img
            class="board-detail-cover"
            id="boardDetailCover"
            src=""
            alt="Board Cover"
          />
          <div class="board-detail-info">
            <h2 id="boardDetailName"></h2>
            <p id="boardDetailDescription"></p>
            <div class="board-stats">
              <div class="board-stat">
                <div class="board-stat-value" id="boardImagesCount">0</div>
                <div class="board-stat-label">Gambar</div>
              </div>
              <div class="board-stat">
                <div class="board-stat-value" id="boardCreatedDate"></div>
                <div class="board-stat-label">Dibuat</div>
              </div>
            </div>
            <div class="board-actions">
              <button class="btn btn-primary" onclick="editBoard()">
                <i class="fas fa-edit"></i> Edit
              </button>
              <button class="btn btn-danger" onclick="deleteBoard()">
                <i class="fas fa-trash"></i> Hapus
              </button>
            </div>
          </div>
        </div>

        <div class="tab-navigation">
          <button class="tab-btn active" onclick="switchBoardTab('images')">
            <i class="fas fa-images"></i> Semua Gambar
          </button>
          <button class="tab-btn" onclick="switchBoardTab('manage')">
            <i class="fas fa-cog"></i> Kelola
          </button>
        </div>

        <div class="tab-content active" id="boardImagesTab">
          <div class="board-images-grid">
            <div class="gallery-grid" id="boardImagesGrid"></div>
            <div class="empty-state" id="boardEmptyState">
              <i class="fas fa-images"></i>
              <h3>Belum ada gambar</h3>
              <p>Tambahkan gambar ke board ini</p>
            </div>
          </div>
        </div>

        <div class="tab-content" id="boardManageTab">
          <div class="settings-section">
            <h3><i class="fas fa-edit"></i> Edit Board</h3>
            <form onsubmit="updateBoardDetails(event)">
              <div class="form-group">
                <label class="form-label">Nama Board</label>
                <input
                  type="text"
                  class="form-input"
                  id="editBoardName"
                  required
                />
              </div>
              <div class="form-group">
                <label class="form-label">Deskripsi</label>
                <textarea
                  class="form-textarea"
                  id="editBoardDescription"
                  rows="3"
                ></textarea>
              </div>
              <div class="form-group">
                <label class="form-label">Cover Board</label>
                <div class="cover-upload">
                  <img
                    class="create-board-cover"
                    id="editBoardCoverPreview"
                    src=""
                    alt="Cover Preview"
                  />
                  <input
                    type="file"
                    id="editBoardCover"
                    accept="image/*"
                    style="display: none"
                    onchange="handleEditBoardCover(event)"
                  />
                  <label for="editBoardCover">
                    <i class="fas fa-camera"></i> Ubah Cover
                  </label>
                </div>
              </div>
              <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-save"></i> Simpan Perubahan
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Asset Detail Modal -->
    <div class="asset-detail-modal" id="assetDetailModal">
      <div class="asset-detail-container">
        <div class="asset-detail-header">
          <div class="asset-detail-title-section">
            <h2 id="assetDetailTitle"></h2>
            <span class="asset-badge" id="assetBadge"></span>
          </div>
          <button class="asset-detail-close" onclick="closeAssetDetail()">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="asset-detail-content" id="assetDetailContent">
          <div class="asset-detail-left">
            <div class="asset-preview-container">
              <img
                class="asset-preview"
                id="assetPreview"
                src=""
                alt="Preview"
              />
            </div>
          </div>

          <div class="asset-detail-right">
            <div class="asset-stats">
              <div class="asset-stat">
                <div class="asset-stat-value" id="assetLikes">0</div>
                <div class="asset-stat-label">Likes</div>
              </div>
              <div class="asset-stat">
                <div class="asset-stat-value" id="assetDownloads">0</div>
                <div class="asset-stat-label">Downloads</div>
              </div>
              <div class="asset-stat">
                <div class="asset-stat-value" id="assetViews">0</div>
                <div class="asset-stat-label">Views</div>
              </div>
              <div class="asset-stat">
                <div class="asset-stat-value" id="assetFormat">PNG</div>
                <div class="asset-stat-label">Format</div>
              </div>
            </div>

            <div class="premium-options">
              <h3><i class="fas fa-crown"></i> Opsi Premium</h3>

              <div class="options-grid">
                <div class="option-group">
                  <label
                    ><i class="fas fa-expand-arrows-alt"></i> Resolusi</label
                  >
                  <div class="option-radio-group">
                    <div class="option-radio">
                      <input
                        type="radio"
                        id="resSmall"
                        name="resolution"
                        value="small"
                        checked
                      />
                      <label for="resSmall"
                        >Small<br /><small>800px</small></label
                      >
                    </div>
                    <div class="option-radio">
                      <input
                        type="radio"
                        id="resMedium"
                        name="resolution"
                        value="medium"
                      />
                      <label for="resMedium"
                        >Medium<br /><small>1920px</small></label
                      >
                    </div>
                    <div class="option-radio">
                      <input
                        type="radio"
                        id="resLarge"
                        name="resolution"
                        value="large"
                      />
                      <label for="resLarge"
                        >Large<br /><small>3840px</small></label
                      >
                    </div>
                  </div>
                </div>

                <div class="option-group">
                  <label><i class="fas fa-file-image"></i> Format File</label>
                  <div class="option-radio-group">
                    <div class="option-radio">
                      <input
                        type="radio"
                        id="formatPNG"
                        name="format"
                        value="png"
                        checked
                      />
                      <label for="formatPNG">PNG</label>
                    </div>
                    <div class="option-radio">
                      <input
                        type="radio"
                        id="formatJPG"
                        name="format"
                        value="jpg"
                      />
                      <label for="formatJPG">JPG</label>
                    </div>
                  </div>
                </div>
              </div>

              <div class="asset-actions">
                <button class="asset-action-btn primary" id="downloadBtn">
                  <i class="fas fa-download"></i>
                  <span>Download</span>
                </button>
                <button class="asset-action-btn favorite" id="favoriteBtn">
                  <i class="fas fa-heart"></i>
                  <span>Favorit</span>
                </button>
              </div>
            </div>

            <div class="license-info">
              <h4><i class="fas fa-balance-scale"></i> Informasi Lisensi</h4>
              <p id="licenseText"></p>
              <span class="license-tag" id="licenseTag"></span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
      <i class="fas fa-check-circle"></i>
      <span id="toastMessage">Berhasil!</span>
    </div>

    <script>
      // Global Variables
      let images = [];
      let users = [];
      let boards = [];
      let currentUser = null;
      let currentFilter = "all";
      let currentView = "grid";
      let currentImageIndex = 0;
      let currentUploadFile = null;
      let currentTags = [];
      let selectedBoardId = null;
      let currentBoardDetailId = null;
      let floatingDownloadBtn = null;
      let currentAssetId = null;

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        loadFromStorage();
        initializeDragAndDrop();
        initializeTagInput();
        generateSampleImages();
        generateSampleUsers();
        generateSampleBoards();
        updateUI();
        renderGallery();
      });

      // Storage Functions
      function saveToStorage() {
        localStorage.setItem("pingallery_images", JSON.stringify(images));
        localStorage.setItem("pingallery_users", JSON.stringify(users));
        localStorage.setItem("pingallery_boards", JSON.stringify(boards));
        if (currentUser) {
          localStorage.setItem(
            "pingallery_currentUser",
            JSON.stringify(currentUser)
          );
        }
      }

      function loadFromStorage() {
        const storedImages = localStorage.getItem("pingallery_images");
        const storedUsers = localStorage.getItem("pingallery_users");
        const storedBoards = localStorage.getItem("pingallery_boards");
        const storedCurrentUser = localStorage.getItem(
          "pingallery_currentUser"
        );

        if (storedImages) images = JSON.parse(storedImages);
        if (storedUsers) users = JSON.parse(storedUsers);
        if (storedBoards) boards = JSON.parse(storedBoards);
        if (storedCurrentUser) currentUser = JSON.parse(storedCurrentUser);
      }

      // Generate Sample Data
      function generateSampleImages() {
        if (images.length === 0) {
          const sampleImages = [
            {
              id: 1,
              title: "Sunset di Pantai",
              description:
                "Matahari terbenam yang indah di tepi pantai dengan warna jingga yang memukau",
              category: "nature",
              format: "jpg",
              likes: 234,
              saves: 89,
              tags: ["sunset", "pantai", "alam"],
              url: "https://picsum.photos/seed/sunset1/800/600.jpg",
              hdUrl: "https://picsum.photos/seed/sunset1/1920/1080.jpg",
              sdUrl: "https://picsum.photos/seed/sunset1/1280/720.jpg",
              userId: 1,
              uploadDate: new Date("2024-01-15").toISOString(),
              fileSize: "2.4 MB",
              dimensions: "1920x1080",
              viewCount: 1234,
              downloadCount: 45,
            },
            {
              id: 2,
              title: "Gedung Pencakar Langit",
              description:
                "Arsitektur modern dengan desain futuristik di pusat kota",
              category: "architecture",
              format: "jpg",
              likes: 156,
              saves: 45,
              tags: ["arsitektur", "kota", "modern"],
              url: "https://picsum.photos/seed/building1/800/1200.jpg",
              hdUrl: "https://picsum.photos/seed/building1/1920/1080.jpg",
              sdUrl: "https://picsum.photos/seed/building1/1280/720.jpg",
              userId: null,
              uploadDate: new Date("2024-01-20").toISOString(),
              fileSize: "3.1 MB",
              dimensions: "1080x1920",
              viewCount: 892,
              downloadCount: 32,
            },
            {
              id: 3,
              title: "Kucing Lucu",
              description:
                "Kucing persia dengan bulu lembut dan mata biru yang indah",
              category: "animals",
              format: "png",
              likes: 512,
              saves: 203,
              tags: ["kucing", "hewan", "lucu"],
              url: "https://picsum.photos/seed/cat1/800/800.jpg",
              hdUrl: "https://picsum.photos/seed/cat1/1920/1080.jpg",
              sdUrl: "https://picsum.photos/seed/cat1/1280/720.jpg",
              userId: 1,
              uploadDate: new Date("2024-01-25").toISOString(),
              fileSize: "1.8 MB",
              dimensions: "1024x1024",
              viewCount: 2341,
              downloadCount: 78,
            },
            {
              id: 4,
              title: "Makanan Lezat",
              description: "Hidangan gourmet dengan presentasi yang menarik",
              category: "food",
              format: "jpg",
              likes: 189,
              saves: 67,
              tags: ["makanan", "gourmet", "kuliner"],
              url: "https://picsum.photos/seed/food1/800/600.jpg",
              hdUrl: "https://picsum.photos/seed/food1/1920/1080.jpg",
              sdUrl: "https://picsum.photos/seed/food1/1280/720.jpg",
              userId: null,
              uploadDate: new Date("2024-02-01").toISOString(),
              fileSize: "2.7 MB",
              dimensions: "1600x1200",
              viewCount: 1567,
              downloadCount: 56,
            },
            {
              id: 5,
              title: "Teknologi Modern",
              description:
                "Perangkat teknologi terbaru dengan desain minimalis",
              category: "technology",
              format: "webp",
              likes: 298,
              saves: 112,
              tags: ["teknologi", "gadget", "modern"],
              url: "https://picsum.photos/seed/tech1/800/600.jpg",
              hdUrl: "https://picsum.photos/seed/tech1/1920/1080.jpg",
              sdUrl: "https://picsum.photos/seed/tech1/1280/720.jpg",
              userId: null,
              uploadDate: new Date("2024-02-05").toISOString(),
              fileSize: "1.5 MB",
              dimensions: "1920x1080",
              viewCount: 987,
              downloadCount: 41,
            },
            {
              id: 6,
              title: "Seni Abstrak",
              description: "Karya seni abstrak dengan warna-warna cerah",
              category: "art",
              format: "png",
              likes: 167,
              saves: 78,
              tags: ["seni", "abstrak", "warna"],
              url: "https://picsum.photos/seed/art1/800/600.jpg",
              hdUrl: "https://picsum.photos/seed/art1/1920/1080.jpg",
              sdUrl: "https://picsum.photos/seed/art1/1280/720.jpg",
              userId: null,
              uploadDate: new Date("2024-02-10").toISOString(),
              fileSize: "3.2 MB",
              dimensions: "2560x1440",
              viewCount: 743,
              downloadCount: 29,
            },
            {
              id: 7,
              title: "Fashion Trend",
              description: "Trend fashion terbaru dengan desain elegan",
              category: "fashion",
              format: "jpg",
              likes: 423,
              saves: 189,
              tags: ["fashion", "trend", "style"],
              url: "https://picsum.photos/seed/fashion1/800/1000.jpg",
              hdUrl: "https://picsum.photos/seed/fashion1/1920/1080.jpg",
              sdUrl: "https://picsum.photos/seed/fashion1/1280/720.jpg",
              userId: null,
              uploadDate: new Date("2024-02-15").toISOString(),
              fileSize: "2.9 MB",
              dimensions: "1080x1350",
              viewCount: 1876,
              downloadCount: 63,
            },
            {
              id: 8,
              title: "Petualangan Gunung",
              description: "Pemandangan gunung yang menakjubkan dari puncak",
              category: "travel",
              format: "jpg",
              likes: 345,
              saves: 156,
              tags: ["gunung", "petualangan", "alam"],
              url: "https://picsum.photos/seed/mountain1/800/600.jpg",
              hdUrl: "https://picsum.photos/seed/mountain1/1920/1080.jpg",
              sdUrl: "https://picsum.photos/seed/mountain1/1280/720.jpg",
              userId: 1,
              uploadDate: new Date("2024-02-20").toISOString(),
              fileSize: "3.5 MB",
              dimensions: "3840x2160",
              viewCount: 2543,
              downloadCount: 87,
            },
          ];
          images = sampleImages;
          saveToStorage();
        }
      }

      function generateSampleUsers() {
        if (users.length === 0) {
          const sampleUsers = [
            {
              id: 1,
              name: "John Doe",
              username: "johndoe",
              email: "john@example.com",
              password: "password123",
              bio: "Fotografer amatir yang suka mengabadikan momen",
              location: "Jakarta, Indonesia",
              website: "https://johndoe.com",
              avatar: "https://picsum.photos/seed/john/200/200.jpg",
              language: "id",
              theme: "light",
              notificationsEmail: true,
              profilePublic: true,
              showEmail: false,
              allowTagging: true,
              likedImages: [1, 3, 5],
              savedImages: [1, 2, 4],
              createdAt: new Date("2024-01-01").toISOString(),
            },
          ];
          users = sampleUsers;
          saveToStorage();
        }
      }

      function generateSampleBoards() {
        if (boards.length === 0) {
          const sampleBoards = [
            {
              id: 1,
              name: "Inspirasi Desain",
              description: "Koleksi desain yang menginspirasi",
              cover: "https://picsum.photos/seed/design1/600/400.jpg",
              userId: 1,
              pins: [1, 5, 6],
              isPrivate: false,
              createdAt: new Date("2024-01-10").toISOString(),
            },
            {
              id: 2,
              name: "Alam & Landscape",
              description: "Keindahan alam dari seluruh dunia",
              cover: "https://picsum.photos/seed/nature1/600/400.jpg",
              userId: 1,
              pins: [1, 8],
              isPrivate: false,
              createdAt: new Date("2024-01-15").toISOString(),
            },
            {
              id: 3,
              name: "Ide Makanan",
              description: "Resep dan presentasi makanan",
              cover: "https://picsum.photos/seed/food2/600/400.jpg",
              userId: 1,
              pins: [4],
              isPrivate: true,
              createdAt: new Date("2024-01-20").toISOString(),
            },
          ];
          boards = sampleBoards;
          saveToStorage();
        }
      }

      // UI Update Functions
      function updateUI() {
        const navActions = document.getElementById("navActions");
        const heroActions = document.getElementById("heroActions");
        const ctaBox = document.getElementById("ctaBox");

        if (currentUser) {
          // User is logged in
          navActions.innerHTML = `
                    <div class="user-menu">
                        <img class="user-avatar" src="${
                          currentUser.avatar ||
                          "https://picsum.photos/seed/" +
                            currentUser.email +
                            "/100/100.jpg"
                        }" alt="User" onclick="toggleUserMenu()">
                        <div class="user-dropdown" id="userDropdown">
                            <div class="dropdown-item" onclick="showProfile()">
                                <i class="fas fa-user"></i>
                                <span>Profil Saya</span>
                            </div>
                            <div class="dropdown-item" onclick="showMyImages()">
                                <i class="fas fa-images"></i>
                                <span>Gambar Saya</span>
                            </div>
                            <div class="dropdown-item" onclick="showMyBoards()">
                                <i class="fas fa-layer-group"></i>
                                <span>Board Saya</span>
                            </div>
                            <div class="dropdown-item" onclick="showSavedImages()">
                                <i class="fas fa-bookmark"></i>
                                <span>Disimpan</span>
                            </div>
                            <div class="dropdown-item" onclick="showSettings()">
                                <i class="fas fa-cog"></i>
                                <span>Pengaturan</span>
                            </div>
                            <div class="dropdown-divider"></div>
                            <div class="dropdown-item" onclick="logout()">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Keluar</span>
                            </div>
                        </div>
                    </div>
                `;

          // Update hero section for logged in user
          heroActions.innerHTML = `
                    <button class="cta-btn" onclick="showProfile()">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <span>Unggah Gambar</span>
                    </button>
                `;

          document.getElementById(
            "heroTitle"
          ).textContent = `Selamat datang kembali, ${currentUser.name}!`;
          document.getElementById("heroSubtitle").textContent =
            "Lanjutkan eksplorasi dan bagikan inspirasi Anda";

          // Update profile section
          document.getElementById("profileName").textContent = currentUser.name;
          document.getElementById("profileEmail").textContent =
            currentUser.email;
          document.getElementById("profileAvatar").src =
            currentUser.avatar ||
            "https://picsum.photos/seed/" + currentUser.email + "/200/200.jpg";

          // Sembunyikan CTA box jika user sudah login
          if (ctaBox) {
            ctaBox.style.display = "none";
          }

          updateProfileStats();
          updateProfileHeaderInfo();
          loadProfileDetails();
        } else {
          // User is not logged in
          navActions.innerHTML = `
                    <button class="btn btn-primary" onclick="showAuthModal()">
                        <i class="fas fa-user"></i>
                        <span>Masuk</span>
                    </button>
                `;

          // Reset hero section
          document.getElementById("heroTitle").textContent =
            "Temukan & Bagikan Inspirasi Visual";
          document.getElementById("heroSubtitle").textContent =
            "Platform berbagi gambar dengan jutaan koleksi dari seluruh dunia";

          // Tampilkan CTA box di gallery jika user belum login
          if (ctaBox && images.length > 0) {
            ctaBox.style.display = "block";
          }
        }
      }

      function updateProfileStats() {
        if (!currentUser) return;

        const userImages = images.filter(
          (img) => img.userId === currentUser.id
        );
        const userLikes = userImages.reduce((sum, img) => sum + img.likes, 0);
        const userSaves = userImages.reduce((sum, img) => sum + img.saves, 0);

        document.getElementById("userImagesCount").textContent =
          userImages.length;
        document.getElementById("userLikesCount").textContent = userLikes;
        document.getElementById("userSavesCount").textContent = userSaves;
      }

      // Fungsi untuk toggle informasi profil
      function toggleProfileDetails() {
        const detailsSection = document.getElementById("profileDetailsSection");
        const toggleArrow = document.getElementById("profileToggleArrow");

        detailsSection.classList.toggle("active");
        toggleArrow.classList.toggle("active");
      }

      // Fungsi untuk mengedit informasi profil
      function editProfileInfo() {
        // Buka modal settings untuk edit profil
        showSettings();
        // Pindah ke tab profil
        setTimeout(() => {
          switchSettingsTab("profile");
        }, 100);
      }

      // Fungsi untuk memuat data profil ke dalam detail section
      function loadProfileDetails() {
        if (!currentUser) return;

        // Isi data dari currentUser
        document.getElementById("profileDetailName").textContent =
          currentUser.name || "Tidak ada";
        document.getElementById("profileDetailUsername").textContent =
          currentUser.username || "Tidak ada";
        document.getElementById("profileDetailEmail").textContent =
          currentUser.email || "Tidak ada";

        // Lokasi
        const location = currentUser.location;
        document.getElementById("profileDetailLocation").textContent =
          location || "Belum diatur";
        if (!location) {
          document
            .getElementById("profileDetailLocation")
            .classList.add("empty");
        }

        // Website
        const website = currentUser.website;
        let websiteHtml = "-";
        if (website) {
          websiteHtml = `<a href="${website}" target="_blank" style="color: var(--primary-color); text-decoration: none;">${website}</a>`;
        }
        document.getElementById("profileDetailWebsite").innerHTML = websiteHtml;
        if (!website) {
          document
            .getElementById("profileDetailWebsite")
            .classList.add("empty");
        }

        // Tanggal bergabung
        const joinedDate = currentUser.createdAt
          ? new Date(currentUser.createdAt).toLocaleDateString("id-ID", {
              year: "numeric",
              month: "long",
              day: "numeric",
            })
          : "-";
        document.getElementById("profileDetailJoined").textContent = joinedDate;

        // Bio
        const bio = currentUser.bio;
        document.getElementById("profileDetailBio").textContent =
          bio || "Belum ada bio";
        if (!bio) {
          document.getElementById("profileDetailBio").classList.add("empty");
        }
      }

      // Fungsi untuk mengisi data profil di header
      function updateProfileHeaderInfo() {
        if (!currentUser) return;

        // Data utama (sudah ada)
        document.getElementById("profileName").textContent = currentUser.name;
        document.getElementById("profileEmail").textContent = currentUser.email;
      }

      // Fungsi untuk menampilkan/menyembunyikan tombol kembali
      function toggleBackButtons(show) {
        const quickBackBtn = document.getElementById("quickBackBtn");

        // Tampilkan/sembunyikan quick back button
        if (quickBackBtn) {
          quickBackBtn.style.display = show ? "flex" : "none";
        }

        // Update tombol di header
        updateNavigationHeader();
      }

      function updateNavigationHeader() {
        const navActions = document.getElementById("navActions");

        // Jika sedang di halaman khusus (bukan home), tambahkan tombol kembali
        const isInSpecialPage =
          document
            .getElementById("profileSection")
            .classList.contains("active") ||
          document
            .getElementById("savedSection")
            .classList.contains("active") ||
          document
            .getElementById("myBoardsSection")
            .classList.contains("active") ||
          (document.getElementById("gallerySection").style.display ===
            "block" &&
            document.getElementById("galleryTitle").textContent ===
              "Gambar Saya");

        if (
          isInSpecialPage &&
          currentUser &&
          navActions.innerHTML.indexOf("btn-back") === -1
        ) {
          const backButton = `
            <button class="btn btn-secondary btn-back" onclick="showHome()" style="margin-right: 10px;">
              <i class="fas fa-arrow-left"></i>
              <span>Kembali</span>
            </button>
          `;

          // Update navActions dengan menambahkan tombol kembali
          const userMenu = navActions.querySelector(".user-menu");
          if (userMenu) {
            navActions.innerHTML = backButton + navActions.innerHTML;
          }
        } else if (!isInSpecialPage) {
          // Hapus tombol kembali jika ada
          const backBtn = navActions.querySelector(".btn-back");
          if (backBtn) {
            backBtn.remove();
          }
        }
      }

      // Auth Functions
      function showAuthModal() {
        document.getElementById("authModal").classList.add("active");
        document.body.style.overflow = "hidden";
        document.body.classList.add("modal-open");
      }

      function closeAuthModal() {
        document.getElementById("authModal").classList.remove("active");
        document.body.style.overflow = "auto";
        document.body.classList.remove("modal-open");
        clearAuthForms();
      }

      function switchAuthTab(tab) {
        const loginForm = document.getElementById("loginForm");
        const registerForm = document.getElementById("registerForm");
        const tabs = document.querySelectorAll(".auth-tab");

        tabs.forEach((t) => t.classList.remove("active"));

        if (tab === "login") {
          loginForm.style.display = "block";
          registerForm.style.display = "none";
          tabs[0].classList.add("active");
        } else {
          loginForm.style.display = "none";
          registerForm.style.display = "block";
          tabs[1].classList.add("active");
        }
      }

      function handleLogin(event) {
        event.preventDefault();

        const email = document.getElementById("loginEmail").value;
        const password = document.getElementById("loginPassword").value;

        // Validation
        let isValid = true;

        if (!validateEmail(email)) {
          document.getElementById("loginEmail").classList.add("error");
          document.getElementById("loginEmailError").classList.add("show");
          isValid = false;
        }

        if (password.length < 6) {
          document.getElementById("loginPassword").classList.add("error");
          document.getElementById("loginPasswordError").classList.add("show");
          isValid = false;
        }

        if (!isValid) return;

        // Check user exists
        const user = users.find(
          (u) => u.email === email && u.password === password
        );

        if (user) {
          currentUser = user;
          saveToStorage();
          updateUI();
          closeAuthModal();
          showToast(`Selamat datang kembali, ${user.name}!`, "success");
        } else {
          showToast("Email atau password salah!", "error");
        }
      }

      function handleRegister(event) {
        event.preventDefault();

        const name = document.getElementById("registerName").value;
        const email = document.getElementById("registerEmail").value;
        const password = document.getElementById("registerPassword").value;
        const confirmPassword = document.getElementById(
          "registerConfirmPassword"
        ).value;

        // Validation
        let isValid = true;

        if (name.trim().length < 2) {
          document.getElementById("registerName").classList.add("error");
          document.getElementById("registerNameError").classList.add("show");
          isValid = false;
        }

        if (!validateEmail(email)) {
          document.getElementById("registerEmail").classList.add("error");
          document.getElementById("registerEmailError").classList.add("show");
          isValid = false;
        }

        if (password.length < 6) {
          document.getElementById("registerPassword").classList.add("error");
          document
            .getElementById("registerPasswordError")
            .classList.add("show");
          isValid = false;
        }

        if (password !== confirmPassword) {
          document
            .getElementById("registerConfirmPassword")
            .classList.add("error");
          document
            .getElementById("registerConfirmPasswordError")
            .classList.add("show");
          isValid = false;
        }

        if (!isValid) return;

        // Check if user already exists
        if (users.find((u) => u.email === email)) {
          showToast("Email sudah terdaftar!", "error");
          return;
        }

        // Create new user
        const newUser = {
          id: Date.now(),
          name: name,
          username: email.split("@")[0],
          email: email,
          password: password,
          bio: "",
          location: "",
          website: "",
          avatar: null,
          language: "id",
          theme: "light",
          notificationsEmail: true,
          profilePublic: true,
          showEmail: false,
          allowTagging: true,
          likedImages: [],
          savedImages: [],
          createdAt: new Date().toISOString(),
        };

        users.push(newUser);
        currentUser = newUser;
        saveToStorage();
        updateUI();
        closeAuthModal();
        showToast(`Selamat bergabung, ${name}!`, "success");
      }

      function logout() {
        currentUser = null;
        localStorage.removeItem("pingallery_currentUser");
        updateUI();
        showHome();
        toggleBackButtons(false);
        showToast("Anda telah keluar", "success");
      }

      function toggleUserMenu() {
        const dropdown = document.getElementById("userDropdown");
        dropdown.classList.toggle("active");
      }

      // Validation Functions
      function validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
      }

      function togglePassword(inputId) {
        const input = document.getElementById(inputId);
        const icon = event.target
          .closest(".password-toggle")
          .querySelector("i");

        if (input.type === "password") {
          input.type = "text";
          icon.classList.remove("fa-eye");
          icon.classList.add("fa-eye-slash");
        } else {
          input.type = "password";
          icon.classList.remove("fa-eye-slash");
          icon.classList.add("fa-eye");
        }
      }

      function clearAuthForms() {
        document.getElementById("loginEmail").value = "";
        document.getElementById("loginPassword").value = "";
        document.getElementById("registerName").value = "";
        document.getElementById("registerEmail").value = "";
        document.getElementById("registerPassword").value = "";
        document.getElementById("registerConfirmPassword").value = "";

        document.querySelectorAll(".form-input").forEach((input) => {
          input.classList.remove("error");
        });
        document.querySelectorAll(".error-message").forEach((msg) => {
          msg.classList.remove("show");
        });
      }

      function socialLogin(provider) {
        showToast(`Login dengan ${provider} akan segera hadir!`, "success");
      }

      // Navigation Functions
      function showHome() {
        document.getElementById("heroSection").style.display = "block";
        document.getElementById("profileSection").classList.remove("active");
        document.getElementById("categoriesSection").style.display = "block";
        document.getElementById("gallerySection").style.display = "block";
        document.getElementById("savedSection").classList.remove("active");
        document.getElementById("myBoardsSection").classList.remove("active");
        document.getElementById("galleryTitle").textContent = "Galeri Gambar";
        currentFilter = "all";

        // Reset category pills
        document.querySelectorAll(".category-pill").forEach((pill, index) => {
          if (index === 0) {
            pill.classList.add("active");
          } else {
            pill.classList.remove("active");
          }
        });

        renderGallery();
        toggleBackButtons(false);
      }

      function showProfile() {
        document.getElementById("heroSection").style.display = "none";
        document.getElementById("profileSection").classList.add("active");
        document.getElementById("categoriesSection").style.display = "none";
        document.getElementById("gallerySection").style.display = "none";
        document.getElementById("savedSection").classList.remove("active");
        document.getElementById("myBoardsSection").classList.remove("active");
        document.getElementById("userDropdown").classList.remove("active");

        // Sembunyikan CTA box di profile
        const ctaBox = document.getElementById("ctaBox");
        if (ctaBox) {
          ctaBox.style.display = "none";
        }

        updateProfileStats();
        // LOAD DETAIL PROFIL - TAMBAHAN
        loadProfileDetails();
        updateProfileHeaderInfo();

        // Reset toggle info profil ke tertutup
        document
          .getElementById("profileDetailsSection")
          .classList.remove("active");
        document
          .getElementById("profileToggleArrow")
          .classList.remove("active");

        toggleBackButtons(true);
      }

      function showMyImages() {
        if (!currentUser) {
          showAuthModal();
          return;
        }

        const userImages = images.filter(
          (img) => img.userId === currentUser.id
        );
        renderFilteredGallery(userImages);
        document.getElementById("galleryTitle").textContent = "Gambar Saya";
        document.getElementById("userDropdown").classList.remove("active");

        document.getElementById("heroSection").style.display = "none";
        document.getElementById("profileSection").classList.remove("active");
        document.getElementById("categoriesSection").style.display = "block";
        document.getElementById("gallerySection").style.display = "block";
        document.getElementById("savedSection").classList.remove("active");
        document.getElementById("myBoardsSection").classList.remove("active");

        // Sembunyikan CTA box di halaman gambar saya
        const ctaBox = document.getElementById("ctaBox");
        if (ctaBox) {
          ctaBox.style.display = "none";
        }

        toggleBackButtons(true);
      }

      function showMyBoards() {
        if (!currentUser) {
          showAuthModal();
          return;
        }

        document.getElementById("heroSection").style.display = "none";
        document.getElementById("profileSection").classList.remove("active");
        document.getElementById("categoriesSection").style.display = "none";
        document.getElementById("gallerySection").style.display = "none";
        document.getElementById("savedSection").classList.remove("active");
        document.getElementById("myBoardsSection").classList.add("active");
        document.getElementById("userDropdown").classList.remove("active");

        loadMyBoards();
        toggleBackButtons(true);
      }

      function showSavedImages() {
        if (!currentUser) {
          showAuthModal();
          return;
        }

        document.getElementById("heroSection").style.display = "none";
        document.getElementById("profileSection").classList.remove("active");
        document.getElementById("categoriesSection").style.display = "none";
        document.getElementById("gallerySection").style.display = "none";
        document.getElementById("savedSection").classList.add("active");
        document.getElementById("myBoardsSection").classList.remove("active");
        document.getElementById("userDropdown").classList.remove("active");

        loadSavedBoards();
        loadSavedImages();
        toggleBackButtons(true);
      }

      function showSettings() {
        if (!currentUser) {
          showAuthModal();
          return;
        }

        // Load current user data into settings form
        document.getElementById("settingsName").value = currentUser.name || "";
        document.getElementById("settingsUsername").value =
          currentUser.username || currentUser.email.split("@")[0];
        document.getElementById("settingsBio").value = currentUser.bio || "";
        document.getElementById("settingsWebsite").value =
          currentUser.website || "";
        document.getElementById("settingsLocation").value =
          currentUser.location || "";
        document.getElementById("settingsEmail").value =
          currentUser.email || "";
        document.getElementById("settingsAvatar").src =
          currentUser.avatar ||
          "https://picsum.photos/seed/" + currentUser.email + "/200/200.jpg";

        // Load preferences
        document.getElementById("settingsLanguage").value =
          currentUser.language || "id";
        document.getElementById("settingsTheme").value =
          currentUser.theme || "light";
        document.getElementById("settingsNotificationsEmail").checked =
          currentUser.notificationsEmail !== false;
        document.getElementById("settingsProfilePublic").checked =
          currentUser.profilePublic !== false;
        document.getElementById("settingsShowEmail").checked =
          currentUser.showEmail || false;
        document.getElementById("settingsAllowTagging").checked =
          currentUser.allowTagging !== false;

        document.getElementById("settingsModal").classList.add("active");
        document.body.style.overflow = "hidden";
        document.body.classList.add("modal-open");
        document.getElementById("userDropdown").classList.remove("active");
      }

      // Settings Functions
      function closeSettingsModal() {
        document.getElementById("settingsModal").classList.remove("active");
        document.body.style.overflow = "auto";
        document.body.classList.remove("modal-open");
      }

      function switchSettingsTab(tab) {
        const tabs = document.querySelectorAll(".settings-tab");
        const forms = document.querySelectorAll(".settings-form");

        tabs.forEach((t) => t.classList.remove("active"));
        forms.forEach((f) => (f.style.display = "none"));

        document
          .querySelector(`.settings-tab[onclick*="${tab}"]`)
          .classList.add("active");
        document.getElementById(`${tab}Settings`).style.display = "block";
      }

      function updateProfile(event) {
        event.preventDefault();

        if (!currentUser) return;

        currentUser.name = document.getElementById("settingsName").value;
        currentUser.username =
          document.getElementById("settingsUsername").value;
        currentUser.bio = document.getElementById("settingsBio").value;
        currentUser.website = document.getElementById("settingsWebsite").value;
        currentUser.location =
          document.getElementById("settingsLocation").value;

        saveToStorage();
        updateUI();
        showToast("Profil berhasil diperbarui!", "success");
        closeSettingsModal();
      }

      function updateAccountSettings(event) {
        event.preventDefault();

        if (!currentUser) return;

        const currentPassword = document.getElementById(
          "settingsCurrentPassword"
        ).value;
        const newPassword = document.getElementById(
          "settingsNewPassword"
        ).value;
        const confirmPassword = document.getElementById(
          "settingsConfirmPassword"
        ).value;

        if (newPassword || confirmPassword) {
          if (newPassword.length < 6) {
            showToast("Password baru minimal 6 karakter!", "error");
            return;
          }

          if (newPassword !== confirmPassword) {
            showToast("Password baru tidak cocok!", "error");
            return;
          }

          if (currentPassword !== currentUser.password) {
            showToast("Password lama salah!", "error");
            return;
          }

          currentUser.password = newPassword;
          showToast("Password berhasil diubah!", "success");
        }

        currentUser.email = document.getElementById("settingsEmail").value;

        saveToStorage();
        updateUI();
        showToast("Pengaturan akun berhasil diperbarui!", "success");
        closeSettingsModal();
      }

      function updatePreferences(event) {
        event.preventDefault();

        if (!currentUser) return;

        currentUser.language =
          document.getElementById("settingsLanguage").value;
        currentUser.theme = document.getElementById("settingsTheme").value;
        currentUser.notificationsEmail = document.getElementById(
          "settingsNotificationsEmail"
        ).checked;
        currentUser.profilePublic = document.getElementById(
          "settingsProfilePublic"
        ).checked;
        currentUser.showEmail =
          document.getElementById("settingsShowEmail").checked;
        currentUser.allowTagging = document.getElementById(
          "settingsAllowTagging"
        ).checked;

        saveToStorage();
        showToast("Preferensi berhasil diperbarui!", "success");
        closeSettingsModal();
      }

      function handleAvatarUpload(event) {
        const file = event.target.files[0];
        if (!file) return;

        if (!file.type.startsWith("image/")) {
          showToast("File harus berupa gambar!", "error");
          return;
        }

        const reader = new FileReader();
        reader.onload = function (e) {
          currentUser.avatar = e.target.result;
          document.getElementById("settingsAvatar").src = e.target.result;
        };
        reader.readAsDataURL(file);
      }

      function exportData() {
        if (!currentUser) return;

        const userData = {
          user: currentUser,
          images: images.filter((img) => img.userId === currentUser.id),
          boards: boards.filter((board) => board.userId === currentUser.id),
        };

        const dataStr = JSON.stringify(userData, null, 2);
        const dataUri =
          "data:application/json;charset=utf-8," + encodeURIComponent(dataStr);
        const exportFileDefaultName = `pingallery-export-${
          currentUser.username
        }-${Date.now()}.json`;

        const linkElement = document.createElement("a");
        linkElement.setAttribute("href", dataUri);
        linkElement.setAttribute("download", exportFileDefaultName);
        linkElement.click();

        showToast("Data berhasil diekspor!", "success");
      }

      function requestAccountDeletion() {
        if (
          confirm(
            "Apakah Anda yakin ingin menghapus akun? Semua data akan dihapus permanen dan tidak dapat dikembalikan."
          )
        ) {
          // Remove user data
          users = users.filter((u) => u.id !== currentUser.id);
          images = images.filter((img) => img.userId !== currentUser.id);
          boards = boards.filter((board) => board.userId !== currentUser.id);

          currentUser = null;
          localStorage.removeItem("pingallery_currentUser");
          saveToStorage();
          updateUI();
          showToast("Akun berhasil dihapus", "success");
          closeSettingsModal();
        }
      }

      // Saved Images Functions
      function switchSavedTab(tab) {
        const tabs = document.querySelectorAll("#savedSection .tab-btn");
        const contents = document.querySelectorAll(
          "#savedSection .tab-content"
        );

        tabs.forEach((t) => t.classList.remove("active"));
        contents.forEach((c) => c.classList.remove("active"));

        document
          .querySelector(`#savedSection .tab-btn[onclick*="${tab}"]`)
          .classList.add("active");
        document
          .getElementById(
            `saved${tab.charAt(0).toUpperCase() + tab.slice(1)}Tab`
          )
          .classList.add("active");
      }

      function loadSavedBoards() {
        const savedBoardsGrid = document.getElementById("savedBoardsGrid");
        const userBoards = boards.filter(
          (board) => board.userId === currentUser.id
        );

        if (userBoards.length === 0) {
          savedBoardsGrid.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-bookmark"></i>
                        <h3>Belum ada board</h3>
                        <p>Buat board pertama Anda</p>
                    </div>
                `;
          return;
        }

        savedBoardsGrid.innerHTML = "";
        userBoards.forEach((board) => {
          const boardElement = document.createElement("div");
          boardElement.className = "board-card";
          boardElement.onclick = () => openBoardDetail(board.id);

          const imageCount = board.pins ? board.pins.length : 0;
          const coverImage =
            board.cover ||
            (board.pins && board.pins.length > 0
              ? images.find((img) => img.id === board.pins[0])?.url
              : "https://picsum.photos/seed/board" + board.id + "/600/400.jpg");

          boardElement.innerHTML = `
                    <img class="board-cover-img" src="${coverImage}" alt="${
            board.name
          }">
                    <div class="board-info">
                        <div class="board-name">${board.name}</div>
                        <div class="board-description">${
                          board.description || "Tidak ada deskripsi"
                        }</div>
                        <div class="board-meta">
                            <span>${imageCount} gambar</span>
                            <span>${new Date(
                              board.createdAt
                            ).toLocaleDateString("id-ID")}</span>
                        </div>
                    </div>
                `;

          savedBoardsGrid.appendChild(boardElement);
        });
      }

      function loadSavedImages() {
        const savedImagesGrid = document.getElementById("savedImagesGrid");
        const savedEmptyState = document.getElementById("savedEmptyState");

        if (!currentUser.savedImages || currentUser.savedImages.length === 0) {
          savedImagesGrid.style.display = "none";
          savedEmptyState.style.display = "block";
          return;
        }

        savedImagesGrid.style.display = "grid";
        savedEmptyState.style.display = "none";
        savedImagesGrid.innerHTML = "";

        const savedImages = images.filter((img) =>
          currentUser.savedImages.includes(img.id)
        );

        savedImages.forEach((image, index) => {
          const imageIndex = images.findIndex((img) => img.id === image.id);
          const card = createImageCard(image, imageIndex);
          savedImagesGrid.appendChild(card);
        });
      }

      // My Boards Functions
      function loadMyBoards() {
        const myBoardsGrid = document.getElementById("myBoardsGrid");
        const userBoards = boards.filter(
          (board) => board.userId === currentUser.id
        );

        // Clear existing content
        myBoardsGrid.innerHTML = "";

        // Add create board card
        const createCard = document.createElement("div");
        createCard.className = "board-card create-board-card";
        createCard.onclick = openCreateBoardModal;
        createCard.innerHTML = `
                <div class="create-board-content">
                    <i class="fas fa-plus-circle"></i>
                    <h3>Buat Board Baru</h3>
                    <p>Kumpulkan gambar favorit Anda</p>
                </div>
            `;
        myBoardsGrid.appendChild(createCard);

        // Add existing boards
        userBoards.forEach((board) => {
          const boardElement = document.createElement("div");
          boardElement.className = "board-card";
          boardElement.onclick = () => openBoardDetail(board.id);

          const imageCount = board.pins ? board.pins.length : 0;
          const coverImage =
            board.cover ||
            (board.pins && board.pins.length > 0
              ? images.find((img) => img.id === board.pins[0])?.url
              : "https://picsum.photos/seed/board" + board.id + "/600/400.jpg");

          boardElement.innerHTML = `
                    <img class="board-cover-img" src="${coverImage}" alt="${
            board.name
          }">
                    <div class="board-info">
                        <div class="board-name">${board.name}</div>
                        <div class="board-description">${
                          board.description || "Tidak ada deskripsi"
                        }</div>
                        <div class="board-meta">
                            <span>${imageCount} gambar</span>
                            <span>${new Date(
                              board.createdAt
                            ).toLocaleDateString("id-ID")}</span>
                        </div>
                    </div>
                `;

          myBoardsGrid.appendChild(boardElement);
        });
      }

      // Create Board Functions
      function openCreateBoardModal() {
        document.getElementById("createBoardModal").classList.add("active");
        document.body.style.overflow = "hidden";
        document.body.classList.add("modal-open");
      }

      function closeCreateBoardModal() {
        document.getElementById("createBoardModal").classList.remove("active");
        document.body.style.overflow = "auto";
        document.body.classList.remove("modal-open");
      }

      function handleBoardCover(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (e) {
          document.getElementById("boardCoverPreview").src = e.target.result;
        };
        reader.readAsDataURL(file);
      }

      function createBoardSubmit(event) {
        event.preventDefault();

        const name = document.getElementById("boardName").value;
        const description = document.getElementById("boardDescription").value;
        const isPrivate = document.getElementById("boardPrivate").checked;
        const cover = document.getElementById("boardCoverPreview").src;

        const newBoard = {
          id: Date.now() + Math.random(),
          name: name,
          description: description,
          cover: cover,
          isPrivate: isPrivate,
          userId: currentUser.id,
          pins: [],
          createdAt: new Date().toISOString(),
        };

        boards.push(newBoard);
        saveToStorage();
        closeCreateBoardModal();
        showMyBoards();
        showToast("Board berhasil dibuat!", "success");
      }

      // Board Detail Functions
      function openBoardDetail(boardId) {
        currentBoardDetailId = boardId;
        const board = boards.find((b) => b.id === boardId);
        if (!board) return;

        // Set board details
        document.getElementById("boardDetailName").textContent = board.name;
        document.getElementById("boardDetailDescription").textContent =
          board.description || "Tidak ada deskripsi";
        document.getElementById("boardDetailCover").src =
          board.cover ||
          "https://picsum.photos/seed/board" + board.id + "/600/400.jpg";
        document.getElementById("boardImagesCount").textContent = board.pins
          ? board.pins.length
          : 0;
        document.getElementById("boardCreatedDate").textContent = new Date(
          board.createdAt
        ).toLocaleDateString("id-ID");

        // Set edit form values
        document.getElementById("editBoardName").value = board.name;
        document.getElementById("editBoardDescription").value =
          board.description || "";
        document.getElementById("editBoardCoverPreview").src =
          board.cover ||
          "https://picsum.photos/seed/board" + board.id + "/600/400.jpg";

        // Load board images
        renderBoardImages(boardId);

        // Show modal
        document.getElementById("boardDetailModal").classList.add("active");
        document.body.style.overflow = "hidden";
        document.body.classList.add("modal-open");
      }

      function closeBoardDetail() {
        document.getElementById("boardDetailModal").classList.remove("active");
        document.body.style.overflow = "auto";
        document.body.classList.remove("modal-open");
      }

      function switchBoardTab(tab) {
        const tabs = document.querySelectorAll("#boardDetailModal .tab-btn");
        const contents = document.querySelectorAll(
          "#boardDetailModal .tab-content"
        );

        tabs.forEach((t) => t.classList.remove("active"));
        contents.forEach((c) => c.classList.remove("active"));

        document
          .querySelector(`#boardDetailModal .tab-btn[onclick*="${tab}"]`)
          .classList.add("active");
        document
          .getElementById(
            `board${tab.charAt(0).toUpperCase() + tab.slice(1)}Tab`
          )
          .classList.add("active");
      }

      function renderBoardImages(boardId) {
        const board = boards.find((b) => b.id === boardId);
        const boardImagesGrid = document.getElementById("boardImagesGrid");
        const boardEmptyState = document.getElementById("boardEmptyState");

        if (!board.pins || board.pins.length === 0) {
          boardImagesGrid.style.display = "none";
          boardEmptyState.style.display = "block";
          return;
        }

        boardImagesGrid.style.display = "grid";
        boardEmptyState.style.display = "none";
        boardImagesGrid.innerHTML = "";

        board.pins.forEach((pinId) => {
          const image = images.find((img) => img.id === pinId);
          if (image) {
            const imageIndex = images.findIndex((img) => img.id === pinId);
            const card = createImageCard(image, imageIndex);
            boardImagesGrid.appendChild(card);
          }
        });
      }

      function editBoard() {
        switchBoardTab("manage");
      }

      function handleEditBoardCover(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (e) {
          document.getElementById("editBoardCoverPreview").src =
            e.target.result;
        };
        reader.readAsDataURL(file);
      }

      function updateBoardDetails(event) {
        event.preventDefault();

        if (!currentBoardDetailId) return;

        const board = boards.find((b) => b.id === currentBoardDetailId);
        if (!board) return;

        board.name = document.getElementById("editBoardName").value;
        board.description = document.getElementById(
          "editBoardDescription"
        ).value;
        board.cover = document.getElementById("editBoardCoverPreview").src;

        saveToStorage();
        showToast("Board berhasil diperbarui!", "success");
        openBoardDetail(currentBoardDetailId);
      }

      function deleteBoard() {
        if (!currentBoardDetailId) return;

        if (
          confirm(
            "Apakah Anda yakin ingin menghapus board ini? Semua gambar di dalamnya akan dihapus dari board (tetapi tetap ada di akun)."
          )
        ) {
          boards = boards.filter((b) => b.id !== currentBoardDetailId);
          saveToStorage();
          closeBoardDetail();
          showMyBoards();
          showToast("Board berhasil dihapus!", "success");
        }
      }

      // Upload Functions
      function handleFileSelect(event) {
        if (!currentUser) {
          showToast("Silakan login terlebih dahulu!", "error");
          showAuthModal();
          return;
        }

        const files = event.target.files;
        if (files.length > 0) {
          handleFile(files[0]);
        }
      }

      function handleFile(file) {
        if (!file.type.startsWith("image/")) {
          showToast("File tidak valid! Harap unggah gambar", "error");
          return;
        }

        if (file.size > 10 * 1024 * 1024) {
          showToast("File terlalu besar! Maksimal 10MB", "error");
          return;
        }

        currentUploadFile = file;

        const reader = new FileReader();
        reader.onload = function (e) {
          document.getElementById("previewImage").src = e.target.result;
          showUploadModal();
        };
        reader.readAsDataURL(file);
      }

      function showUploadModal() {
        document.getElementById("uploadModal").classList.add("active");
        document.body.style.overflow = "hidden";
        document.body.classList.add("modal-open");
      }

      function closeUploadModal() {
        document.getElementById("uploadModal").classList.remove("active");
        document.body.style.overflow = "auto";
        document.body.classList.remove("modal-open");
        clearUploadForm();
      }

      function clearUploadForm() {
        document.getElementById("uploadForm").reset();
        document.getElementById("previewImage").src = "";
        currentUploadFile = null;
        currentTags = [];
        updateTagsDisplay();

        document
          .querySelectorAll(".form-input, .form-select")
          .forEach((input) => {
            input.classList.remove("error");
          });
        document.querySelectorAll(".error-message").forEach((msg) => {
          msg.classList.remove("show");
        });
      }

      function handleUploadSubmit(event) {
        event.preventDefault();

        const title = document.getElementById("imageTitle").value.trim();
        const description = document
          .getElementById("imageDescription")
          .value.trim();
        const category = document.getElementById("imageCategory").value;

        let isValid = true;

        if (!title) {
          document.getElementById("imageTitle").classList.add("error");
          document.getElementById("titleError").classList.add("show");
          isValid = false;
        }

        if (!category) {
          document.getElementById("imageCategory").classList.add("error");
          document.getElementById("categoryError").classList.add("show");
          isValid = false;
        }

        if (!isValid || !currentUploadFile) return;

        const reader = new FileReader();
        reader.onload = function (e) {
          const image = {
            id: Date.now() + Math.random(),
            title: title,
            description: description,
            category: category,
            format: currentUploadFile.type.split("/")[1],
            likes: 0,
            saves: 0,
            tags: [...currentTags],
            url: e.target.result,
            hdUrl: e.target.result, // Simulasi URL HD
            sdUrl: e.target.result, // Simulasi URL SD
            userId: currentUser.id,
            uploadDate: new Date().toISOString(),
            fileSize: formatFileSize(currentUploadFile.size),
            dimensions: "1920x1080",
            viewCount: 0,
            downloadCount: 0,
          };

          images.unshift(image);
          saveToStorage();
          updateProfileStats();
          closeUploadModal();
          showToast("Gambar berhasil diunggah!", "success");

          showMyImages();
        };
        reader.readAsDataURL(currentUploadFile);
      }

      function formatFileSize(bytes) {
        if (bytes === 0) return "0 Bytes";
        const k = 1024;
        const sizes = ["Bytes", "KB", "MB", "GB"];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
      }

      // Tag Functions
      function initializeTagInput() {
        const tagInput = document.getElementById("tagInput");

        tagInput.addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            e.preventDefault();
            addTag(this.value.trim());
            this.value = "";
          }
        });
      }

      function addTag(tag) {
        if (tag && !currentTags.includes(tag) && currentTags.length < 10) {
          currentTags.push(tag);
          updateTagsDisplay();
        }
      }

      function removeTag(tag) {
        const index = currentTags.indexOf(tag);
        if (index > -1) {
          currentTags.splice(index, 1);
          updateTagsDisplay();
        }
      }

      function updateTagsDisplay() {
        const tagsDisplay = document.getElementById("tagsDisplay");
        tagsDisplay.innerHTML = "";

        currentTags.forEach((tag) => {
          const tagElement = document.createElement("div");
          tagElement.className = "tag";
          tagElement.innerHTML = `
                    ${tag}
                    <span class="tag-remove" onclick="removeTag('${tag}')">&times;</span>
                `;
          tagsDisplay.appendChild(tagElement);
        });
      }

      // Drag and Drop
      function initializeDragAndDrop() {
        const uploadArea = document.getElementById("uploadArea");

        uploadArea.addEventListener("dragover", (e) => {
          e.preventDefault();
          uploadArea.classList.add("dragover");
        });

        uploadArea.addEventListener("dragleave", () => {
          uploadArea.classList.remove("dragover");
        });

        uploadArea.addEventListener("drop", (e) => {
          e.preventDefault();
          uploadArea.classList.remove("dragover");
          const files = e.dataTransfer.files;
          if (files.length > 0) {
            handleFile(files[0]);
          }
        });
      }

      // Gallery Rendering
      function renderGallery() {
        const filteredImages = filterImages();
        renderFilteredGallery(filteredImages);
      }

      function renderFilteredGallery(filteredImages) {
        const galleryGrid = document.getElementById("galleryGrid");
        const emptyState = document.getElementById("emptyState");
        const ctaBox = document.getElementById("ctaBox");

        if (filteredImages.length === 0) {
          galleryGrid.style.display = "none";
          emptyState.style.display = "block";

          // Sembunyikan CTA box jika tidak ada gambar
          if (ctaBox) {
            ctaBox.style.display = "none";
          }

          if (!currentUser) {
            document.getElementById("emptyStateMessage").textContent =
              "Daftar untuk mulai mengunggah gambar";
          } else {
            document.getElementById("emptyStateMessage").textContent =
              "Belum ada gambar, unggah gambar pertama Anda di profil";
          }
          return;
        }

        galleryGrid.style.display = "grid";
        emptyState.style.display = "none";

        // Tampilkan CTA box hanya untuk guest users dan jika ada gambar
        if (ctaBox && !currentUser) {
          ctaBox.style.display = "block";
        } else if (ctaBox && currentUser) {
          ctaBox.style.display = "none";
        }

        galleryGrid.innerHTML = "";

        filteredImages.forEach((image, index) => {
          const card = createImageCard(image, index);
          galleryGrid.appendChild(card);
        });
      }

      function createImageCard(image, index) {
        const card = document.createElement("div");
        card.className = "image-card";

        if (currentView === "masonry") {
          const height = 200 + Math.random() * 300;
          card.style.setProperty("--image-height", `${height}px`);
        }

        const isLiked =
          currentUser &&
          currentUser.likedImages &&
          currentUser.likedImages.includes(image.id);
        const isSaved =
          currentUser &&
          currentUser.savedImages &&
          currentUser.savedImages.includes(image.id);

        card.innerHTML = `
                <div class="image-wrapper">
                    <img src="${image.url}" alt="${
          image.title
        }" onclick="showAssetDetail(${image.id})">
                    <div class="image-overlay">
                        <div class="overlay-actions">
                            <button class="overlay-btn ${
                              isLiked ? "liked" : ""
                            }" onclick="event.stopPropagation(); likeImageById(${
          image.id
        })">
                                <i class="fas fa-heart"></i> ${image.likes}
                            </button>
                            <button class="overlay-btn ${
                              isSaved ? "saved" : ""
                            }" onclick="event.stopPropagation(); saveImageById(${
          image.id
        })">
                                <i class="fas fa-bookmark"></i> ${image.saves}
                            </button>
                        </div>
                    </div>
                </div>
                <div class="image-info">
                    <div class="image-title">${image.title}</div>
                    ${
                      image.description
                        ? `<div class="image-description">${image.description}</div>`
                        : ""
                    }
                    ${
                      image.tags && image.tags.length > 0
                        ? `
                        <div class="image-tags">
                            ${image.tags
                              .map(
                                (tag) =>
                                  `<span class="image-tag">#${tag}</span>`
                              )
                              .join("")}
                        </div>
                    `
                        : ""
                    }
                    <div class="image-meta">
                        <span class="format-badge">${image.format.toUpperCase()}</span>
                        <div class="image-stats">
                            <span class="stat"><i class="fas fa-eye"></i> ${
                              image.viewCount || 0
                            }</span>
                            <span class="stat"><i class="fas fa-download"></i> ${
                              image.downloadCount || 0
                            }</span>
                        </div>
                    </div>
                </div>
            `;

        return card;
      }

      // Filter Functions
      function filterImages() {
        let filtered = [...images];

        if (currentFilter !== "all") {
          filtered = filtered.filter((img) => img.category === currentFilter);
        }

        const searchTerm = document
          .getElementById("searchInput")
          .value.toLowerCase();
        if (searchTerm) {
          filtered = filtered.filter(
            (img) =>
              img.title.toLowerCase().includes(searchTerm) ||
              (img.description &&
                img.description.toLowerCase().includes(searchTerm)) ||
              img.category.toLowerCase().includes(searchTerm) ||
              (img.tags &&
                img.tags.some((tag) => tag.toLowerCase().includes(searchTerm)))
          );
        }

        return filtered;
      }

      function filterByCategory(category) {
        currentFilter = category;

        document.querySelectorAll(".category-pill").forEach((pill) => {
          pill.classList.remove("active");
        });
        event.target.classList.add("active");

        renderGallery();
      }

      function filterByFormat(format) {
        if (format === "all") {
          renderGallery();
          return;
        }

        const galleryGrid = document.getElementById("galleryGrid");
        galleryGrid.innerHTML = "";

        const filtered = images.filter((img) => img.format === format);
        renderFilteredGallery(filtered);
      }

      function sortImages(sortBy) {
        switch (sortBy) {
          case "newest":
            images.sort(
              (a, b) => new Date(b.uploadDate) - new Date(a.uploadDate)
            );
            break;
          case "oldest":
            images.sort(
              (a, b) => new Date(a.uploadDate) - new Date(b.uploadDate)
            );
            break;
          case "popular":
            images.sort((a, b) => b.likes - a.likes);
            break;
          case "name":
            images.sort((a, b) => a.title.localeCompare(b.title));
            break;
        }
        renderGallery();
      }

      // Search Function
      function searchImages() {
        renderGallery();
      }

      document
        .getElementById("searchInput")
        .addEventListener("keyup", function (e) {
          if (e.key === "Enter") {
            searchImages();
          }
        });

      // View Mode
      function setViewMode(mode) {
        currentView = mode;
        const galleryGrid = document.getElementById("galleryGrid");

        document.querySelectorAll(".view-btn").forEach((btn) => {
          btn.classList.remove("active");
        });
        event.target.closest(".view-btn").classList.add("active");

        if (mode === "masonry") {
          galleryGrid.classList.add("masonry");
        } else {
          galleryGrid.classList.remove("masonry");
        }

        renderGallery();
      }

      // Enhanced Image Detail Modal Functions
      function openImageDetail(index) {
        currentImageIndex = index;
        const image = images[index];

        // Update modal content
        document.getElementById("detailImage").src = image.url;
        document.getElementById("detailTitle").textContent = image.title;
        document.getElementById("detailDescription").textContent =
          image.description || "Tidak ada deskripsi";
        document.getElementById("detailCategory").textContent = getCategoryName(
          image.category
        );
        document.getElementById("fileFormat").textContent =
          image.format.toUpperCase();
        document.getElementById("fileSize").textContent =
          image.fileSize || "Unknown";
        document.getElementById("fileDimensions").textContent =
          image.dimensions || "Unknown";
        document.getElementById("viewCount").textContent = image.viewCount || 0;
        document.getElementById("downloadCount").textContent =
          image.downloadCount || 0;
        document.getElementById("detailLikeCount").textContent = image.likes;

        // Update author info
        const author = image.userId
          ? users.find((u) => u.id === image.userId)
          : null;
        if (author) {
          document.getElementById("authorAvatar").src =
            author.avatar ||
            "https://picsum.photos/seed/" + author.email + "/100/100.jpg";
          document.getElementById("authorName").textContent = author.name;
        } else {
          document.getElementById("authorAvatar").src =
            "https://picsum.photos/seed/default/100/100.jpg";
          document.getElementById("authorName").textContent = "Anonymous";
        }

        // Update upload date
        const uploadDate = new Date(image.uploadDate);
        document.getElementById("uploadDate").textContent =
          uploadDate.toLocaleDateString("id-ID", {
            year: "numeric",
            month: "long",
            day: "numeric",
          });

        // Update tags
        const tagsContainer = document.getElementById("detailTags");
        tagsContainer.innerHTML = "";
        if (image.tags && image.tags.length > 0) {
          image.tags.forEach((tag) => {
            const tagElement = document.createElement("span");
            tagElement.className = "detail-tag";
            tagElement.textContent = `#${tag}`;
            tagElement.onclick = () => searchByTag(tag);
            tagsContainer.appendChild(tagElement);
          });
        } else {
          tagsContainer.innerHTML =
            '<span style="color: var(--text-secondary);">Tidak ada tag</span>';
        }

        // Update like button state
        const likeBtn = document.getElementById("detailLikeBtn");
        const isLiked =
          currentUser &&
          currentUser.likedImages &&
          currentUser.likedImages.includes(image.id);
        if (isLiked) {
          likeBtn.classList.add("liked");
        } else {
          likeBtn.classList.remove("liked");
        }

        // Update save button state
        const saveBtn = document.getElementById("detailSaveBtn");
        const isSaved =
          currentUser &&
          currentUser.savedImages &&
          currentUser.savedImages.includes(image.id);
        if (isSaved) {
          saveBtn.classList.add("saved");
        } else {
          saveBtn.classList.remove("saved");
        }

        // Increment view count
        image.viewCount = (image.viewCount || 0) + 1;
        saveToStorage();

        // Show modal
        document.getElementById("imageDetailModal").classList.add("active");
        document.body.style.overflow = "hidden";
        document.body.classList.add("modal-open");

        // Buat floating download button
        createFloatingDownloadButton();
      }

      function createFloatingDownloadButton() {
        // Hapus floating button yang lama jika ada
        if (floatingDownloadBtn) {
          floatingDownloadBtn.remove();
        }

        // Buat floating button baru
        floatingDownloadBtn = document.createElement("button");
        floatingDownloadBtn.className = "floating-download-btn";
        floatingDownloadBtn.innerHTML = '<i class="fas fa-download"></i>';
        floatingDownloadBtn.onclick = showDownloadOptions;
        floatingDownloadBtn.title = "Download Gambar";
        document.body.appendChild(floatingDownloadBtn);
      }

      function closeImageDetail() {
        // Hapus floating button
        if (floatingDownloadBtn) {
          floatingDownloadBtn.remove();
          floatingDownloadBtn = null;
        }

        document.getElementById("imageDetailModal").classList.remove("active");
        document.body.style.overflow = "auto";
        document.body.classList.remove("modal-open");
      }

      function toggleZoom() {
        const detailImage = document.getElementById("detailImage");
        detailImage.classList.toggle("zoomed");
      }

      function getCategoryName(category) {
        const categoryNames = {
          nature: "Alam",
          architecture: "Arsitektur",
          people: "Orang",
          technology: "Teknologi",
          animals: "Hewan",
          food: "Makanan",
          travel: "Travel",
          art: "Seni",
          fashion: "Fashion",
          design: "Desain",
          aesthetic: "Estetika",
        };
        return categoryNames[category] || category;
      }

      function searchByTag(tag) {
        document.getElementById("searchInput").value = `#${tag}`;
        searchImages();
        closeImageDetail();
      }

      // Download Functions
      function showDownloadOptions() {
        const image = images[currentImageIndex];
        const downloadOptions = document.getElementById("downloadOptions");

        downloadOptions.innerHTML = `
          <div class="download-option" onclick="downloadImageWithQuality('original')">
            <div class="option-info">
              <h4>Original Quality</h4>
              <p>${image.dimensions || "Unknown"}  ${
          image.fileSize || "Unknown"
        }</p>
            </div>
            <i class="fas fa-download"></i>
          </div>
          <div class="download-option" onclick="downloadImageWithQuality('hd')">
            <div class="option-info">
              <h4>High Quality</h4>
              <p>1920x1080  ~2MB</p>
            </div>
            <i class="fas fa-download"></i>
          </div>
          <div class="download-option" onclick="downloadImageWithQuality('sd')">
            <div class="option-info">
              <h4>Medium Quality</h4>
              <p>1280x720  ~800KB</p>
            </div>
            <i class="fas fa-download"></i>
          </div>
        `;

        document.getElementById("downloadModal").classList.add("active");
        document.body.style.overflow = "hidden";
        document.body.classList.add("modal-open");
      }

      function closeDownloadModal() {
        document.getElementById("downloadModal").classList.remove("active");
        document.body.style.overflow = "auto";
        document.body.classList.remove("modal-open");
      }

      function downloadImageWithQuality(quality = "original") {
        const image = images[currentImageIndex];
        let downloadUrl = image.url;

        // Pilih URL berdasarkan kualitas
        if (quality === "hd" && image.hdUrl) {
          downloadUrl = image.hdUrl;
        } else if (quality === "sd" && image.sdUrl) {
          downloadUrl = image.sdUrl;
        }

        // Buat elemen link untuk download
        const link = document.createElement("a");
        const fileName = `${image.title.replace(
          /[^\w\s]/gi,
          ""
        )}_${quality}_${Date.now()}.${image.format}`;

        link.href = downloadUrl;
        link.download = fileName;
        link.style.display = "none";

        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        // Update download count
        image.downloadCount = (image.downloadCount || 0) + 1;
        saveToStorage();

        // Update UI
        document.getElementById("downloadCount").textContent =
          image.downloadCount;

        // Tampilkan toast notification
        showToast(
          `Gambar "${image.title}" (${quality}) sedang diunduh...`,
          "success"
        );

        // Tutup modal download
        closeDownloadModal();
      }

      // Like and Save Functions
      function toggleLike() {
        if (!currentUser) {
          showToast("Silakan login terlebih dahulu!", "error");
          closeImageDetail();
          showAuthModal();
          return;
        }

        const image = images[currentImageIndex];
        likeImageById(image.id);
      }

      function likeImageById(id) {
        if (!currentUser) {
          showToast("Silakan login terlebih dahulu!", "error");
          return;
        }

        const image = images.find((img) => img.id === id);
        if (image) {
          if (!currentUser.likedImages) currentUser.likedImages = [];

          const index = currentUser.likedImages.indexOf(id);
          if (index > -1) {
            currentUser.likedImages.splice(index, 1);
            image.likes--;
            showToast("Like dihapus", "success");
          } else {
            currentUser.likedImages.push(id);
            image.likes++;
            showToast("Gambar disukai!", "success");
          }

          saveToStorage();
          renderGallery();
          updateProfileStats();

          if (
            document
              .getElementById("imageDetailModal")
              .classList.contains("active")
          ) {
            document.getElementById("detailLikeCount").textContent =
              image.likes;
            const likeBtn = document.getElementById("detailLikeBtn");
            if (index > -1) {
              likeBtn.classList.remove("liked");
            } else {
              likeBtn.classList.add("liked");
            }
          }
        }
      }

      function saveImageById(id) {
        if (!currentUser) {
          showToast("Silakan login terlebih dahulu!", "error");
          return;
        }

        const image = images.find((img) => img.id === id);
        if (image) {
          if (!currentUser.savedImages) currentUser.savedImages = [];

          const index = currentUser.savedImages.indexOf(id);
          if (index > -1) {
            currentUser.savedImages.splice(index, 1);
            image.saves--;
            showToast("Dihapus dari tersimpan", "success");
          } else {
            openBoardModalForImage(id);
          }

          saveToStorage();
          renderGallery();
          updateProfileStats();
        }
      }

      // Board Functions
      function openBoardModal() {
        if (!currentUser) {
          showToast("Silakan login terlebih dahulu!", "error");
          closeImageDetail();
          showAuthModal();
          return;
        }

        const image = images[currentImageIndex];
        openBoardModalForImage(image.id);
      }

      function openBoardModalForImage(imageId) {
        selectedBoardId = null;
        renderBoardsForImage(imageId);
        document.getElementById("boardModal").classList.add("active");
        document.body.style.overflow = "hidden";
        document.body.classList.add("modal-open");
      }

      function closeBoardModal() {
        document.getElementById("boardModal").classList.remove("active");
        document.body.style.overflow = "auto";
        document.body.classList.remove("modal-open");
      }

      function renderBoardsForImage(imageId) {
        const boardsList = document.getElementById("boardsList");
        const userBoards = boards.filter(
          (board) => board.userId === currentUser.id
        );

        if (userBoards.length === 0) {
          boardsList.innerHTML =
            '<p style="text-align: center; color: var(--text-secondary);">Belum ada board. Buat board baru untuk mulai menyimpan gambar.</p>';
          return;
        }

        boardsList.innerHTML = "";
        userBoards.forEach((board) => {
          const boardElement = document.createElement("div");
          boardElement.className = "board-item";
          boardElement.onclick = () => selectBoard(board.id);

          const imageCount = board.pins ? board.pins.length : 0;
          const isSaved = board.pins && board.pins.includes(imageId);

          boardElement.innerHTML = `
                    <img class="board-cover" src="${
                      board.cover ||
                      "https://picsum.photos/seed/board" +
                        board.id +
                        "/200/150.jpg"
                    }" alt="${board.name}">
                    <div class="board-info">
                        <h4>${board.name}</h4>
                        <p>${imageCount} pin</p>
                        ${
                          isSaved
                            ? '<span style="color: var(--primary-color); font-size: 0.75rem;"><i class="fas fa-check"></i> Tersimpan</span>'
                            : ""
                        }
                    </div>
                `;

          if (isSaved) {
            boardElement.classList.add("selected");
            selectedBoardId = board.id;
          }

          boardsList.appendChild(boardElement);
        });
      }

      function selectBoard(boardId) {
        selectedBoardId = boardId;

        document.querySelectorAll(".board-item").forEach((item) => {
          item.classList.remove("selected");
        });
        event.currentTarget.classList.add("selected");
      }

      function createNewBoard() {
        const boardName = prompt("Masukkan nama board:");
        if (!boardName || boardName.trim() === "") {
          return;
        }

        const newBoard = {
          id: Date.now(),
          name: boardName.trim(),
          description: "",
          cover: null,
          userId: currentUser.id,
          pins: [],
          isPrivate: false,
          createdAt: new Date().toISOString(),
        };

        boards.push(newBoard);
        saveToStorage();
        const image = images[currentImageIndex];
        renderBoardsForImage(image.id);
        showToast("Board berhasil dibuat!", "success");
      }

      function saveToBoard() {
        if (!selectedBoardId) {
          showToast("Pilih board terlebih dahulu!", "error");
          return;
        }

        const image = images[currentImageIndex];
        const board = boards.find((b) => b.id === selectedBoardId);

        if (!board.pins) board.pins = [];

        if (!board.pins.includes(image.id)) {
          board.pins.push(image.id);
          image.saves++;

          if (!currentUser.savedImages) currentUser.savedImages = [];
          if (!currentUser.savedImages.includes(image.id)) {
            currentUser.savedImages.push(image.id);
          }

          saveToStorage();
          updateProfileStats();
          closeBoardModal();
          showToast(`Gambar berhasil disimpan ke ${board.name}!`, "success");

          // Update UI
          const saveBtn = document.getElementById("detailSaveBtn");
          saveBtn.classList.add("saved");
        } else {
          // Remove from board
          const index = board.pins.indexOf(image.id);
          if (index > -1) {
            board.pins.splice(index, 1);
            image.saves--;

            const userIndex = currentUser.savedImages.indexOf(image.id);
            if (userIndex > -1) {
              currentUser.savedImages.splice(userIndex, 1);
            }

            saveToStorage();
            updateProfileStats();
            closeBoardModal();
            showToast(`Gambar dihapus dari ${board.name}!`, "success");

            // Update UI
            const saveBtn = document.getElementById("detailSaveBtn");
            saveBtn.classList.remove("saved");
          }
        }
      }

      // Share Functions
      function openShareModal() {
        const image = images[currentImageIndex];
        const shareUrl = `${window.location.origin}/image/${image.id}`;

        document.getElementById("shareLink").value = shareUrl;
        document.getElementById("shareModal").classList.add("active");
        document.body.style.overflow = "hidden";
        document.body.classList.add("modal-open");
      }

      function closeShareModal() {
        document.getElementById("shareModal").classList.remove("active");
        document.body.style.overflow = "auto";
        document.body.classList.remove("modal-open");
      }

      function shareToSocial(platform) {
        const image = images[currentImageIndex];
        const shareUrl = `${window.location.origin}/image/${image.id}`;
        const shareText = `Lihat gambar "${image.title}" di PinGallery!`;

        let url = "";
        switch (platform) {
          case "facebook":
            url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(
              shareUrl
            )}`;
            break;
          case "twitter":
            url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(
              shareText
            )}&url=${encodeURIComponent(shareUrl)}`;
            break;
          case "whatsapp":
            url = `https://wa.me/?text=${encodeURIComponent(
              shareText + " " + shareUrl
            )}`;
            break;
          case "telegram":
            url = `https://t.me/share/url?url=${encodeURIComponent(
              shareUrl
            )}&text=${encodeURIComponent(shareText)}`;
            break;
          case "email":
            url = `mailto:?subject=${encodeURIComponent(
              image.title
            )}&body=${encodeURIComponent(shareText + " " + shareUrl)}`;
            break;
          default:
            showToast("Platform akan segera hadir!", "success");
            return;
        }

        window.open(url, "_blank");
        closeShareModal();
      }

      function copyShareLink() {
        const shareLink = document.getElementById("shareLink");
        shareLink.select();
        document.execCommand("copy");
        showToast("Link berhasil disalin!", "success");
      }

      // Asset Detail Functions
      function showAssetDetail(assetId) {
        currentAssetId = assetId;
        const asset = images.find((img) => img.id === assetId);
        if (!asset) {
          showToast("Asset tidak ditemukan!", "error");
          return;
        }

        // Update modal content
        document.getElementById("assetDetailTitle").textContent = asset.title;
        document.getElementById("assetPreview").src = asset.url;

        // Tentukan apakah asset premium atau free
        const isPremium = asset.category === "premium" || asset.likes > 100;
        document.getElementById("assetBadge").textContent = isPremium
          ? "PREMIUM"
          : "FREE";
        document.getElementById("assetBadge").className = `asset-badge ${
          isPremium ? "premium" : "free"
        }`;

        // Update stats
        document.getElementById("assetLikes").textContent = asset.likes || 0;
        document.getElementById("assetDownloads").textContent =
          asset.downloadCount || 0;
        document.getElementById("assetViews").textContent =
          asset.viewCount || 0;
        document.getElementById("assetFormat").textContent = (
          asset.format || "png"
        ).toUpperCase();

        // Update license info
        const licenseInfo = isPremium
          ? "Lisensi Premium: Untuk penggunaan komersial, atribusi tidak diperlukan. Hak cipta tetap dilindungi."
          : "Lisensi Gratis: Untuk penggunaan pribadi dan komersial dengan atribusi wajib.";

        document.getElementById("licenseText").textContent = licenseInfo;
        document.getElementById("licenseTag").textContent = isPremium
          ? "Premium License"
          : "Creative Commons";

        // Update tombol download berdasarkan perangkat
        const downloadBtn = document.getElementById("downloadBtn");
        if (isMobileDevice()) {
          downloadBtn.innerHTML =
            '<i class="fas fa-mobile-alt"></i><span>Simpan ke Galeri</span>';
          downloadBtn.onclick = () => saveToGallery(asset);
        } else {
          downloadBtn.innerHTML =
            '<i class="fas fa-download"></i><span>Download</span>';
          downloadBtn.onclick = () => downloadAsset(asset);
        }

        // Update tombol favorit
        const favoriteBtn = document.getElementById("favoriteBtn");
        const isFavorited =
          currentUser &&
          currentUser.likedImages &&
          currentUser.likedImages.includes(asset.id);
        if (isFavorited) {
          favoriteBtn.classList.add("active");
          favoriteBtn.innerHTML =
            '<i class="fas fa-heart"></i><span>Difavoritkan</span>';
        } else {
          favoriteBtn.classList.remove("active");
          favoriteBtn.innerHTML =
            '<i class="fas fa-heart"></i><span>Favorit</span>';
        }

        favoriteBtn.onclick = () => toggleFavoriteAsset(asset);

        // Deteksi perangkat mobile dan tambah kelas
        const contentElement = document.getElementById("assetDetailContent");
        if (isMobileDevice()) {
          contentElement.classList.add("is-mobile");
        } else {
          contentElement.classList.remove("is-mobile");
        }

        // Increment view count
        asset.viewCount = (asset.viewCount || 0) + 1;
        saveToStorage();

        // Tampilkan modal
        document.getElementById("assetDetailModal").classList.add("active");
        document.body.style.overflow = "hidden";
        document.body.classList.add("modal-open");
      }

      function closeAssetDetail() {
        document.getElementById("assetDetailModal").classList.remove("active");
        document.body.style.overflow = "auto";
        document.body.classList.remove("modal-open");
      }

      function downloadAsset(asset) {
        const resolution = document.querySelector(
          'input[name="resolution"]:checked'
        ).value;
        const format = document.querySelector(
          'input[name="format"]:checked'
        ).value;

        let qualityLabel = "";
        let resolutionValue = "";

        switch (resolution) {
          case "small":
            qualityLabel = "Small";
            resolutionValue = "800px";
            break;
          case "medium":
            qualityLabel = "Medium";
            resolutionValue = "1920px";
            break;
          case "large":
            qualityLabel = "Large";
            resolutionValue = "3840px";
            break;
        }

        // Buat elemen download
        const link = document.createElement("a");
        const fileName = `${asset.title.replace(
          /[^\w\s]/gi,
          ""
        )}_${qualityLabel}_${Date.now()}.${format}`;

        // Gunakan URL yang sesuai
        let downloadUrl = asset.url;
        if (resolution === "large" && asset.hdUrl) {
          downloadUrl = asset.hdUrl;
        } else if (resolution === "small" && asset.sdUrl) {
          downloadUrl = asset.sdUrl;
        }

        link.href = downloadUrl;
        link.download = fileName;
        link.style.display = "none";

        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        // Update download count
        asset.downloadCount = (asset.downloadCount || 0) + 1;
        saveToStorage();

        // Update UI
        document.getElementById("assetDownloads").textContent =
          asset.downloadCount;

        showToast(
          `Asset "${
            asset.title
          }" (${qualityLabel}, ${format.toUpperCase()}) sedang diunduh!`,
          "success"
        );
      }

      function saveToGallery(asset) {
        // Untuk mobile, kita akan simulasi penyimpanan ke galeri
        const resolution = document.querySelector(
          'input[name="resolution"]:checked'
        ).value;

        // Update download count
        asset.downloadCount = (asset.downloadCount || 0) + 1;
        saveToStorage();
        document.getElementById("assetDownloads").textContent =
          asset.downloadCount;

        showToast(
          `Asset "${asset.title}" berhasil disimpan ke galeri!`,
          "success"
        );

        // Untuk browser, tetap lakukan download
        downloadAsset(asset);
      }

      function toggleFavoriteAsset(asset) {
        if (!currentUser) {
          showToast("Silakan login terlebih dahulu!", "error");
          closeAssetDetail();
          showAuthModal();
          return;
        }

        if (!currentUser.likedImages) {
          currentUser.likedImages = [];
        }

        const index = currentUser.likedImages.indexOf(asset.id);
        const favoriteBtn = document.getElementById("favoriteBtn");

        if (index > -1) {
          // Hapus dari favorit
          currentUser.likedImages.splice(index, 1);
          asset.likes = Math.max(0, (asset.likes || 0) - 1);

          favoriteBtn.classList.remove("active");
          favoriteBtn.innerHTML =
            '<i class="fas fa-heart"></i><span>Favorit</span>';

          showToast("Asset dihapus dari favorit", "success");
        } else {
          // Tambah ke favorit
          currentUser.likedImages.push(asset.id);
          asset.likes = (asset.likes || 0) + 1;

          favoriteBtn.classList.add("active");
          favoriteBtn.innerHTML =
            '<i class="fas fa-heart"></i><span>Difavoritkan</span>';

          showToast("Asset ditambahkan ke favorit!", "success");
        }

        // Update UI
        document.getElementById("assetLikes").textContent = asset.likes;

        saveToStorage();
        updateProfileStats();
      }

      // Fungsi untuk mendeteksi perangkat mobile
      function isMobileDevice() {
        return (
          /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
            navigator.userAgent
          ) || window.innerWidth <= 768
        );
      }

      // Toast Notification
      function showToast(message, type = "success") {
        const toast = document.getElementById("toast");
        const toastMessage = document.getElementById("toastMessage");

        toast.className = `toast ${type}`;
        toastMessage.textContent = message;

        const icon = toast.querySelector("i");
        if (type === "error") {
          icon.className = "fas fa-exclamation-circle";
        } else {
          icon.className = "fas fa-check-circle";
        }

        toast.classList.add("show");

        setTimeout(() => {
          toast.classList.remove("show");
        }, 3000);
      }

      // Event Listeners for closing modals when clicking outside
      document.addEventListener("click", function (e) {
        if (!e.target.closest(".user-menu")) {
          document.getElementById("userDropdown").classList.remove("active");
        }
      });

      document
        .getElementById("imageDetailModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeImageDetail();
          }
        });

      document
        .getElementById("authModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeAuthModal();
          }
        });

      document
        .getElementById("uploadModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeUploadModal();
          }
        });

      document
        .getElementById("boardModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeBoardModal();
          }
        });

      document
        .getElementById("shareModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeShareModal();
          }
        });

      document
        .getElementById("settingsModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeSettingsModal();
          }
        });

      document
        .getElementById("createBoardModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeCreateBoardModal();
          }
        });

      document
        .getElementById("boardDetailModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeBoardDetail();
          }
        });

      document
        .getElementById("downloadModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeDownloadModal();
          }
        });

      document
        .getElementById("assetDetailModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeAssetDetail();
          }
        });

      // Keyboard Navigation
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          closeImageDetail();
          closeAuthModal();
          closeUploadModal();
          closeBoardModal();
          closeShareModal();
          closeSettingsModal();
          closeCreateBoardModal();
          closeBoardDetail();
          closeDownloadModal();
          closeAssetDetail();
        }
      });

      // Clear error on input
      document
        .querySelectorAll(".form-input, .form-select, .form-textarea")
        .forEach((input) => {
          input.addEventListener("input", function () {
            this.classList.remove("error");
            const errorMsg = this.parentElement.querySelector(".error-message");
            if (errorMsg) {
              errorMsg.classList.remove("show");
            }
          });
        });
    </script>
  </body>
</html>
